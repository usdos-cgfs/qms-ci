{
  "version": 3,
  "sources": ["../../../src/pages/manage-qo/manage-qo.js"],
  "sourcesContent": ["var user;\r\nvar spGroup;\r\nvar collListItem;\r\nvar businessOfficeAssignments = [];\r\nvar qoCurrentMembers = [];\r\nvar qoTempCurrentMembers = [];\r\nvar qoListMembers = [];\r\n\r\nvar usersToAdd = [];\r\nvar usersToRemove = [];\r\n\r\nfunction initApp() {}\r\n\r\ndocument.getElementById(\"btnSyncArrays\").addEventListener(\"click\", syncArrays);\r\ndocument\r\n  .getElementById(\"btnManageQoGroup\")\r\n  .addEventListener(\"click\", manageQoGroup);\r\n\r\nfunction manageQoGroup() {\r\n  window.open(\r\n    _spPageContextInfo.webAbsoluteUrl +\r\n      \"/_layouts/15/people.aspx?MembershipGroupId=85\",\r\n    \"_blank\"\r\n  );\r\n}\r\n\r\nfunction FetchGroupMembers(groupName) {\r\n  return new Promise((resolve, reject) => {\r\n    var currentContext = new SP.ClientContext.get_current();\r\n    var currentWeb = currentContext.get_web();\r\n\r\n    var currentUser = currentContext.get_web().get_currentUser();\r\n    currentContext.load(currentUser);\r\n\r\n    var allGroups = currentWeb.get_siteGroups();\r\n    currentContext.load(allGroups);\r\n\r\n    var group = allGroups.getByName(groupName);\r\n    currentContext.load(group);\r\n\r\n    var groupUsers = group.get_users();\r\n    currentContext.load(groupUsers);\r\n\r\n    currentContext.executeQueryAsync(OnSuccess, OnFailure);\r\n\r\n    function OnSuccess(sender, args) {\r\n      var users = [];\r\n      var groupUserEnumerator = groupUsers.getEnumerator();\r\n      while (groupUserEnumerator.moveNext()) {\r\n        var user = groupUserEnumerator.get_current();\r\n        //console.log('User: ', groupUser.get_email())\r\n        var userObj = {};\r\n        if (user != null) {\r\n          userObj.id = user.get_id();\r\n          userObj.title = user.get_title();\r\n          userObj.oUser = user;\r\n          users.push(userObj);\r\n        }\r\n      }\r\n      resolve(users);\r\n    }\r\n\r\n    function OnFailure(sender, args) {\r\n      reject(args);\r\n    }\r\n  });\r\n}\r\n\r\nfunction filterById(user, index, array) {\r\n  return (\r\n    index ===\r\n    array.findIndex((innerUser) => {\r\n      return user.id == innerUser.id;\r\n    })\r\n  );\r\n}\r\n\r\nfunction FetchBusinessOfficeAssignments() {\r\n  return new Promise((resolve, reject) => {\r\n    var keys = [\r\n      \"QAO\",\r\n      \"QSO_Charleston\",\r\n      \"QSO_Bangkok\",\r\n      \"QSO_Washington\",\r\n      \"QSO_Paris\",\r\n      \"QSO_Sofia\",\r\n      \"QSO_Manila\",\r\n    ];\r\n    var clientContext = new SP.ClientContext.get_current();\r\n    var website = clientContext.get_web();\r\n    var listRef = website.get_lists().getByTitle(\"Business_Office\");\r\n\r\n    var camlQuery = new SP.CamlQuery();\r\n    camlQuery.set_viewXml(\"<Query></Query>\");\r\n    collListItem = listRef.getItems(camlQuery);\r\n    clientContext.load(collListItem);\r\n    clientContext.executeQueryAsync(\r\n      function () {\r\n        var listItemEnumerator = collListItem.getEnumerator();\r\n        var users = [];\r\n        while (listItemEnumerator.moveNext()) {\r\n          var oListItem = listItemEnumerator.get_current();\r\n          //console.log(oListItem);\r\n          $.each(keys, function (idx, loc) {\r\n            // Iterate through each office\r\n            var user = oListItem.get_item(loc);\r\n            var userObj = {};\r\n            if (user != null) {\r\n              userObj.id = user.get_lookupId();\r\n              userObj.title = user.get_lookupValue();\r\n              userObj.oUser = user;\r\n              users.push(userObj);\r\n            }\r\n          });\r\n        }\r\n        resolve(users.filter(filterById));\r\n      },\r\n      function (sender, args) {\r\n        reject(args);\r\n      }\r\n    );\r\n  });\r\n}\r\n\r\nfunction FetchTempQOAssignments() {\r\n  return new Promise((resolve, reject) => {\r\n    var clientContext = new SP.ClientContext.get_current();\r\n    var website = clientContext.get_web();\r\n    var listRef = website.get_lists().getByTitle(\"Temp_QOs\");\r\n\r\n    var camlQuery = new SP.CamlQuery();\r\n    camlQuery.set_viewXml(\"<Query></Query>\");\r\n    collListItem = listRef.getItems(camlQuery);\r\n    clientContext.load(collListItem);\r\n    clientContext.executeQueryAsync(\r\n      function () {\r\n        var listItemEnumerator = collListItem.getEnumerator();\r\n        var users = [];\r\n        while (listItemEnumerator.moveNext()) {\r\n          var oListItem = listItemEnumerator.get_current();\r\n\r\n          var user = oListItem.get_item(\"Person\");\r\n          var userObj = {};\r\n          if (user != null) {\r\n            userObj.id = user.get_lookupId();\r\n            userObj.title = user.get_lookupValue();\r\n            userObj.oUser = user;\r\n            users.push(userObj);\r\n          }\r\n        }\r\n        resolve(users.filter(filterById));\r\n        //syncArrays();\r\n      },\r\n      function (sender, args) {\r\n        reject(args);\r\n      }\r\n    );\r\n  });\r\n}\r\n\r\nasync function syncArrays() {\r\n  var qoCurrentMembers = await FetchGroupMembers(\"QOs\");\r\n  var qtmCurrentMembers = await FetchGroupMembers(\"QTM\");\r\n  var accessGroupMembers = qoCurrentMembers\r\n    .concat(qtmCurrentMembers)\r\n    .filter(filterById);\r\n  var businessOfficeAssignments = await FetchBusinessOfficeAssignments();\r\n  var tempQOAssignments = await FetchTempQOAssignments();\r\n  var listAssignments = businessOfficeAssignments\r\n    .concat(tempQOAssignments)\r\n    .filter(filterById);\r\n\r\n  businessOfficeAssignments.concat;\r\n  var usersToAdd = listAssignments.filter(\r\n    (person) => !accessGroupMembers.find((member) => member.id === person.id)\r\n  );\r\n  var usersToRemove = accessGroupMembers.filter(\r\n    (member) => !listAssignments.find((person) => person.id === member.id)\r\n  );\r\n\r\n  if (confirm(\"Add the following users:\\n\" + formatUserList(usersToAdd))) {\r\n    console.log(\"adding\");\r\n    await AddUserToSharePointGroup(usersToAdd);\r\n  }\r\n\r\n  if (\r\n    confirm(\"Remove the following users:\\n\" + formatUserList(usersToRemove))\r\n  ) {\r\n    console.log(\"removing\");\r\n    await RemoveUserFromSharePointGroup(usersToRemove);\r\n  }\r\n}\r\n\r\nfunction AddUserToSharePointGroup(userArr) {\r\n  return new Promise((resolve, reject) => {\r\n    var clientContext = new SP.ClientContext.get_current();\r\n    var siteGroups = clientContext.get_web().get_siteGroups();\r\n    var web = clientContext.get_web();\r\n    spGroup = siteGroups.getByName(\"QOs\");\r\n    var userCollection = spGroup.get_users();\r\n    console.log(\"adding \" + userArr.length + \" users\");\r\n    $.each(userArr, function (idx, user) {\r\n      console.log(\"adding: \", user.title);\r\n      userCollection.addUser(web.getUserById(user.id));\r\n    });\r\n    spGroup.update();\r\n    // clientContext.load(user);\r\n    clientContext.load(spGroup);\r\n    clientContext.executeQueryAsync(\r\n      function () {\r\n        alert(\"Successfully Added \" + userArr.length + \" Users\");\r\n        resolve();\r\n      },\r\n      function (sender, args) {\r\n        reject(args);\r\n      }\r\n    );\r\n  });\r\n}\r\n\r\nfunction RemoveUserFromSharePointGroup(userArr) {\r\n  return new Promise((resolve, reject) => {\r\n    var clientContext = new SP.ClientContext.get_current();\r\n    var siteGroups = clientContext.get_web().get_siteGroups();\r\n    var web = clientContext.get_web();\r\n    spGroup = siteGroups.getByName(\"QOs\");\r\n    var userCollection = spGroup.get_users();\r\n    console.log(\"removing \" + userArr.length + \" users\");\r\n    $.each(userArr, function (idx, user) {\r\n      console.log(\"adding: \", user.title);\r\n      userCollection.remove(web.getUserById(user.id));\r\n    });\r\n    spGroup.update();\r\n    // clientContext.load(user);\r\n    clientContext.load(spGroup);\r\n    clientContext.executeQueryAsync(\r\n      function () {\r\n        alert(\"Successfully Removed \" + userArr.length + \" Users\");\r\n        resolve();\r\n      },\r\n      function (sender, args) {\r\n        reject(args);\r\n      }\r\n    );\r\n  });\r\n}\r\n\r\nfunction formatUserList(userArr) {\r\n  return userArr.map((user) => `- ${user.title}\\n`).join(\"\");\r\n}\r\n\r\nfunction onQueryFailed(sender, args) {\r\n  console.error(sender, args);\r\n}\r\n\r\n$(document).ready(function () {\r\n  SP.SOD.executeFunc(\r\n    \"sp.js\",\r\n    \"SP.ClientContext\",\r\n    ExecuteOrDelayUntilScriptLoaded(initApp, \"sp.js\")\r\n  );\r\n});\r\n"],
  "mappings": "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",
  "names": []
}
