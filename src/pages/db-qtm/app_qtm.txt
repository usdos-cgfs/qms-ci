<!DOCTYPE html>

<link rel="stylesheet" type="text/css" href="../SiteAssets/js/lib/DataTables/DataTables-1.10.18/css/jquery.dataTables.min.css" />
<link rel="stylesheet" type="text/css" href="../SiteAssets/css/jqueryui/1.11.3/themes/redmond/jquery-ui.min.css" />
<link rel="stylesheet" type="text/css" href="../SiteAssets/css/tablesorter/style.css" />

<link rel="stylesheet" type="text/css" href="../SiteAssets/css/CAPCAR_Styles.css" />
<!--
<link rel="stylesheet" type="text/css" href="/sites/cgfsweb/QMS/SiteAssets/css/CAPCAR_Page_Reports.css" />
-->
<link rel="stylesheet" type="text/css" href="../SiteAssets/css/BasicTooltip.css" />
<!--<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/buttons/1.6.1/css/buttons.dataTables.min.css" />-->

<div id="warnIE" class="alert alert-warning" role="alert" style="display: none">
    It looks like you're using Internet Explorer, for best performance, please use Edge or Chrome.
</div>

<div id="divLoading" style="color:green; padding-bottom:10px"></div>
<div id="showme">
    <p>Please wait... loading.</p>
    <p>This application is currently only supported in Chrome or Edge.</p>
</div>

<div id="tabs" class="tabclass" style="display:none">
    <ul id="tabList">
        <li><a href="#tabs-0">My CARs/CAPs</a></li>
        <li><a href="#tabs-1">CAR/CAP Details</a></li>
        <li><a href="#tabs-2">Awaiting Action</a></li>
        <li style="display: none"><a href="#tabs-3">Dash</a></li>
        <li><a href="#tabs-4">Lookup</a></li>
    </ul>

    <div id="tabs-0">
        <div id="injectTab0"></div>
        <div class="card" style="padding-bottom:10px">
            <div class="card-header"><h3>My CARs/CAPs</h3></div>
            <div class="card-body">
                <div>
                    <button id="linkSubmitNewCAP" type="button" class="btn btn-outline-success">New</button>
                </div>
                <br />
                <!--<div>
                    <table id="tblcap" class="display" style="width:100%">
                        <thead>
                            <tr>
                                <th>Item #</th>
                                <th>Subject</th>
                                <th>BusinessOffice</th>
                                <th>CGFS Location</th>
                                <th>Submitted Date</th>
                                <th>Submitted By</th>
                                <th>Status</th>
                                <th>Type</th>
                            </tr>
                        </thead>
                        <tfoot>
                            <tr>
                                <th>Item #</th>
                                <th>Subject</th>
                                <th>BusinessOffice</th>
                                <th>CGFS Location</th>
                                <th>Submitted Date</th>
                                <th>Submitted By</th>
                                <th>Status</th>
                                <th>Type</th>
                            </tr>
                        </tfoot>
                    </table>
                </div>-->
                <div class="empty-table" data-bind="visible: MyOpenRecordsArray().length == 0">
                    <h2>You currently have no associated CARs or CAPs.</h2>
                </div>
                <div data-bind="visible: MyOpenRecordsArray().length > 0">
                    <table id="tblMyOpenRecords" class="display">
                        <thead>
                            <tr>
                                <th>Item #</th>
                                <th>Subject</th>
                                <th data-bind="visible: AdminType">Business Office</th>
                                <th>CGFS Location</th>
                                <th>Next Target Date</th>
                                <th>Submitted By</th>
                                <th>Status</th>
                                <th>Type</th>
                            </tr>
                        </thead>
                        <tbody data-bind="foreach: MyOpenRecordsArray">
                            <tr>
                                <td><a href="#" data-bind="click: navigateToRecord.bind($data), text: CAPID"></a></td>
                                <td data-bind="text: Subject"></td>
                                <td data-bind="visible: $root.AdminType(), text: BusinessOffice.split(';#')[1]"></td>
                                <td data-bind="text: CGFSLocation"></td>
                                <td data-bind="text: $root.formatNextTargetDate($data),
                                                style: {'background-color' : $root.highlightOverdue($data) }"></td>
                                <td data-bind="text: SubmittedBy"></td>
                                <td data-bind="text: ProcessStage"></td>
                                <td data-bind="text: RecordType"></td>
                            </tr>
                        </tbody>
                        <tfoot>
                            <tr>
                                <th>Item #</th>
                                <th>Subject</th>
                                <th data-bind="visible: AdminType">Business Office</th>
                                <th>CGFS Location</th>
                                <th>Next Target Date</th>
                                <th>Submitted By</th>
                                <th>Status</th>
                                <th>Type</th>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <div id="tabs-1">
        <div id="datalinkDropDown" style="padding-bottom:15px" class="row">
            <span>ID: </span>
            <select id="ddlCAPID" title="Select a CAP ID" data-bind="options: CAPIDOptions, optionsCaption: '-Select-'"></select>
            <a href="javascript:;"><span id="linkRefresh" class='ui-icon ui-icon-refresh'></span></a>

        </div>
        <!--<div>
            <button id="linkRefresh" type="button" class="btn btn-outline-success">Refresh</button>
        </div>-->

        <div id="detailstab" data-bind="visible: vm.selectedRecord.ID()">
            <div class="progress" style="height: 30px">
                <div class="progress-bar bg-info" role="progressbar" data-bind="style: {width: ProcessPercentage()}" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"><span data-bind="text: ProcessPercentage" /></div>
            </div>
            <div id="capProcessStages" class="row">
                <div class="w-25">
                    <div class="card w-100">
                        <div class="card-header"><h4>Stage 1: Initial Submission</h4></div>
                        <div class="collapse multi-collapse" id="collapseProblemInner">
                            <div class="card-body">
                                <div data-bind="visible: AdminType() == ''">
                                    Check that the below information is correct before submitting this CAR.
                                </div>
                                <div data-bind="visible: AdminType() != ''">
                                    Review the submission below and indicate your approval or rejection of the submission.
                                </div>
                                <!--<br />
                                <button type="button" class="btn btn-outline-primary" id="buttonSubmitProblem">Submit</button>
                                <br />-->
                                <div id="warnAddProblemResolver" data-bind="visible: ShowWarnAddProblemResolver()" class="alert alert-warning" role="alert">
                                    You must add a CAR/CAP coordinator to approve: <span><a href="javascript:;">Resolve</a></span>
                                </div>
                                <div id="adminProblem" class="alert alert-info admin-zone" role="alert">
                                    <h4>Admin Options</h4>
                                    <div class="form-group" id="formApproveProblem">
                                        <button type="button" id="buttonApproveProblem" class="mt-auto btn btn-outline-primary">Approve</button>

                                        <button type="button" id="buttonRejectProblem" class="mt-auto btn btn-outline-primary">Reject</button>

                                        <div id="rejectReasonAreaProblem">
                                            <div>
                                                <textarea id="textAreaRemarkProblem" rows="2" cols="40" placeholder="Rejection Remarks..."></textarea>
                                            </div>
                                            <div>
                                                <button class="mt-auto btn btn-outline-success" id="buttonRejectProblemSubmit" type="button">Submit</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card-footer">
                            <small>Created: <span data-bind="text: Created()"></span> </small>
                        </div>
                    </div>
                </div>
                <div class="w-25">
                    <div class="card w-100">
                        <div class="card-header"><h4>Stage 2: Develop Action Plan</h4></div>
                        <div class="collapse multi-collapse" id="collapseInitialInner">
                            <div class="card-body d-flex flex-column">
                                <div class="form-group" id="formSubmitInitial">
                                    <div data-bind="visible: AdminType() == ''">
                                        Check that the below information is correct before submitting to the Quality Owner for approval.
                                    </div>
                                    <div data-bind="visible: AdminType() != ''">
                                        Review the submission below and indicate your approval or rejection of the submission.
                                    </div>
                                    <div id="warnAddAction" class="alert alert-warning" role="alert" data-bind="visible: NumActions() == 0">
                                        You must add at least one action item to submit. <span><a href="javascript:;">Resolve</a></span>
                                    </div>
                                    <div id="warnAddContainmentAction" class="alert alert-warning" role="alert" data-bind="visible: ShowWarnContainmentAction()">
                                        You must provide a containment action. <span><a href="javascript:;">Resolve</a></span>
                                    </div>
                                    <div id="warnAddWhy" class="alert alert-warning" role="alert" data-bind="visible: ShowWarnWhy()">
                                        You must have at least one Question and Answer for Root Cause. <span><a href="javascript:;">Resolve</a></span>
                                    </div>
                                    <div id="warnAddRootCause" class="alert alert-warning" role="alert" data-bind="visible: ShowWarnRootCause()">
                                        You must provide a root cause analysis. <span><a href="javascript:;">Resolve</a></span>
                                    </div>
                                    <div id="warnAddSimilarNoncomformity" class="alert alert-warning" role="alert" data-bind="visible: ShowWarnNoncomformity()">
                                        You must describe any similar nonconformities. <span><a href="javascript:;">Resolve</a></span>
                                    </div>
                                    <!--<label for="buttonSubmitInitial" data-bind="visible: NumActions">Submit the record for approval by clicking the submit button:</label>--><br />
                                    <button type="button" id="buttonSubmitInitial" class="mt-auto btn btn-outline-primary buttonSubmitInitial"
                                            data-bind="visible: ShowSubmitInitial()">
                                        Submit
                                    </button><br />
                                    <!--<small data-bind="visible: SubmittedDate"> Submitted: <span data-bind="text: SubmittedDate"></span> </small>-->
                                </div>
                                <div class="alert alert-info admin-zone" id="adminInitial">
                                    <div id="warnAddProblemResolver2" class="alert alert-warning" role="alert" data-bind="visible: ShowWarnAddProblemResolver()">
                                        You must assign a CAR/CAP Coordinator. <span><a href="javascript:;">Resolve</a></span>
                                    </div>
                                    <div class="form-group" id="formApproveInitial">
                                        <button type="button" id="buttonApproveInitial" class="mt-auto btn btn-outline-primary" data-bind="enable: !ShowWarnAddProblemResolver()">Approve</button>

                                        <button type="button" id="buttonRejectInitial" class="mt-auto btn btn-outline-primary">Reject</button>

                                        <div id="rejectReasonAreaInitial">
                                            <div>
                                                <textarea id="textAreaRemarkInitial" rows="2" cols="40" placeholder="Rejection Remarks..."></textarea>
                                            </div>
                                            <div>
                                                <button class="mt-auto btn btn-outline-success" id="buttonRejectInitialSubmit" type="button">Submit</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!--Submit for Quality Owner approval. <br />
                                <button type="button" id="linksubmitcapqso" class="btn btn-outline-primary">Submit</button>
                                <a title='Submit CAP' href='javascript:void(0)'><span class='ui-icon ui-icon-ok'></span>Submit CAP for Approval</a> <br />
                                <span id="addactionwarn" style="color:red;">Add at least 1 action to submit.</span> <br />
                                <div data-bind="visible: SubmittedDate"> Submitted: <span data-bind="text: SubmittedDate"></span> </div>-->
                            </div>
                        </div>
                        <div class="card-footer" data-bind="visible: SubmittedDate">
                            <small>Submitted: <span data-bind="text: SubmittedDate"></span> </small>
                        </div>
                    </div>
                </div>
                <div class="w-25">
                    <div class="card w-100">
                        <div class="card-header"><h4>Stage 3: Work Actions</h4></div>

                        <div class="collapse multi-collapse" id="collapseImplementInner">
                            <div class="card-body d-flex flex-column">
                                <div class="form-group" id="formSubmitImplement">
                                    <div id="warnCompleteActions" class="alert alert-warning" role="alert" data-bind="visible: NumOpenActions() > 0">
                                        Complete all actions to submit. <span><a href="javascript:;">Resolve</a></span>
                                    </div>
                                    <div id="warnSetVerification" class="alert alert-warning" role="alert" data-bind="visible: !EffectivenessVerificationTargetDate()">
                                        Set a target effectiveness verification date.
                                    </div>
                                    <div id="warnAddSupportingDoc" class="alert alert-info" role="alert" data-bind="visible: SupportDocuments().length == 0">
                                        Don't forget to attach supporting documents. <span><a href="javascript:;">Resolve</a></span>
                                    </div>
                                    <div data-bind="visible: AdminType() == ''">
                                        Once all action items have been completed, submit the record for implementation approval.
                                    </div>
                                    <div data-bind="visible: AdminType() != ''">
                                        Review the submission below and indicate your approval or rejection of the implementation.
                                    </div>
                                    <br />
                                    <div id="divSubmitTargetVerification">
                                        <label for="dateTargetVerification">Set a target effectiveness verification date:</label><br />
                                        <input type="date" id="dateTargetVerification" data-bind="textInput: EffectivenessVerificationTargetDate" /> <br />

                                        <button type="button" id="buttonSubmitImplement" class="btn btn-outline-primary"
                                                data-bind="Enable: EffectivenessVerificationTargetDate()">
                                            Submit
                                        </button>
                                    </div>
                                    <p><!--Target Verification Date: <em><span data-bind="text: EffectivenessVerificationTargetDate, visible: EffectivenessVerificationTargetDate"></span></em>--></p>
                                    <!--<a title='Submit CAP' id="linksubmitcapimplement" href='javascript:void(0)'><span class='ui-icon ui-icon-ok'></span>Submit CAP for Implementation</a>-->
                                </div>
                                <div class="alert alert-info admin-zone" id="adminImplement">
                                    <div class="form-group" id="formApproveImplement">
                                        <button type="button" id="buttonApproveImplement" class="mt-auto btn btn-outline-primary">Approve</button>

                                        <button type="button" id="buttonRejectImplement" class="mt-auto btn btn-outline-primary">Reject</button>

                                        <div id="rejectReasonAreaImplement">
                                            <div>
                                                <textarea id="textAreaRemarkImplement" rows="2" cols="40" placeholder="Rejection Remarks..."></textarea>
                                            </div>
                                            <div>
                                                <button class="mt-auto btn btn-outline-success" id="buttonRejectImplementSubmit" type="button">Submit</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card-footer" data-bind="visible: SubmittedImplementDate()">

                            <small>Submitted: <span data-bind="text: SubmittedImplementDate"></span></small>
                        </div>
                    </div>
                </div>
                <div class="w-25">
                    <div class="card w-100">
                        <div class="card-header "><h4>Stage 4: Effectiveness</h4></div>
                        <div class="collapse multi-collapse" id="collapseEffectivenessInner">
                            <div class="card-body d-flex flex-column">
                                <div class="form-group" id="formSubmitEffectiveness">
                                    <div id="warnAddEffectivenessDoc" class="alert alert-warning" role="alert" data-bind="visible: ((EffectivenessDocuments().length == 0) && !EffectivenessDescription())">
                                        Add proof of effectiveness documents to submit. <span><a href="javascript:;">Resolve</a></span>
                                    </div>
                                    <div data-bind="visible: AdminType() == ''">
                                        Submit the proof of effectiveness for approval from the Quality Owner and Quality Team.
                                    </div>
                                    <div data-bind="visible: AdminType() != ''">
                                        Review the submission below and indicate your approval or rejection of the effectiveness.
                                    </div>
                                    <button type="button" id="buttonSubmitEffectiveness" class="mt-auto btn btn-outline-primary"
                                            data-bind="enable: buttonSubmitEffectivenessEnable()">
                                        Submit
                                    </button>
                                    <!--a <title='Submit for Effectiveness Approval' href='javascript:void(0)'><span class='ui-icon ui-icon-ok'></span>Submit for Effectiveness Approval</a>-->

                                </div>
                                <div class="alert alert-info admin-zone" id="adminEffectiveness">
                                    <div class="form-group" id="formApproveEffectiveness">
                                        <button type="button" id="buttonApproveEffectiveness" class="mt-auto btn btn-outline-primary">Approve</button>

                                        <!--<a title='Approve CAP' id="linkApproveEffectivenessQSO" href='javascript:void(0)'><span class='ui-icon ui-icon-check'></span>Approve Effectiveness</a>-->

                                        <button type="button" id="buttonRejectEffectiveness" class="mt-auto btn btn-outline-primary">Reject</button>

                                        <!--<a title='Reject CAP' id="linkRejectEffectivenessQSO" href='javascript:void(0)'><span class='ui-icon ui-icon-arrowreturn-1-w'></span>Reject Effectiveness</a>-->

                                        <div id="rejectReasonAreaEffectiveness">
                                            <div>
                                                <select id="selectEffectivenessRejectReason">
                                                    <option value="Not Effective">Not Effective</option>
                                                    <option value="Lack of Evidence">Lack of Evidence</option>
                                                </select>
                                            </div>
                                            <div>
                                                <button class="mt-auto btn btn-outline-success" id="buttonRejectEffectivenessSubmit" type="button">Submit</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card-footer" data-bind="visible: SubmittedEffectivenessDate()">
                            <small>Submitted: <span data-bind="text: SubmittedEffectivenessDate"></span></small>
                        </div>
                    </div>
                </div>
            </div>
            <div id="injectTab1"></div>
            <br />
            <div class="row">
                <div class="col-6">
                    <div id="divRejections"></div>
                    <div id="divInformation">
                        <h3>Information - <span data-bind="text: CAPID()"></span></h3>
                        <h4>Current Status: Stage <span data-bind="text: ProcessStageDesc().stageNum"></span> - <span data-bind="text: ProcessStage()"></span></h4>
                        <h4>Next Target Date: <span data-bind="text: formatNextTargetDate(vm.selectedRecord)"></span></h4>
                        <div>
                            <table id="tblcap4" class="table">
                                <!--<tr>
                                    <td>Record ID:</td>
                                    <td><span data-bind="text: CAPID()"></span></td>
                                </tr>-->
                                <tr>
                                    <td>Subject:</td>
                                    <td><span data-bind="text: Subject()"</td>
                                </tr>
                                <tr>
                                    <td>BusinessOffice:</td>
                                    <td><span data-bind="text: BusinessOffice()"></span></td>
                                </tr>
                                <tr>
                                    <td>CGFS Location:</td>
                                    <td><span data-bind="text: CGFSLocation()"></span></td>
                                </tr>
                                <tr>
                                    <td>QSO:</td>
                                    <td><span data-bind="text: QSO() ? QSO().userName : ''"></span></td>
                                </tr>
                                <tr>
                                    <td>QAO:</td>
                                    <td><span data-bind="text: QAO() ? QAO().userName : ''"></span></td>
                                </tr>
                                <tr>
                                    <td>Source:</td>
                                    <td><span data-bind="text: Source()"></span></td>
                                </tr>
                                <!--<tr data-bind="visible: IsCAR()">
                                    <td>CAR Process Stage:</td>
                                    <td><span data-bind="text: CARProcessStage()"></span></td>
                                </tr>-->
                                <tr data-bind="visible: IsCAR()">
                                    <td>Self-Initiated:</td>
                                    <td><span data-bind="text: SelfInitiated()"></span></td>
                                </tr>
                                <tr id="trProblemResolver">
                                    <td>CAR/CAP Coordinator:</td>
                                    <td>
                                        <span data-bind="text: ProblemResolverUserName() ? ProblemResolverUserName() : 'Not Yet Assigned'"> </span>
                                        <button class="mt-auto btn btn-outline-primary admin-zone" id="buttonEditProblemResolver" type="button">Edit</button>
                                    </td>
                                </tr>
                                <tr data-bind="visible: SubmittedDate()">
                                    <td>Submitted Date:</td>
                                    <td><span data-bind="text: SubmittedDate()"></span></td>
                                </tr>
                                <tr>
                                    <td>Submitted By:</td>
                                    <td><span data-bind="text: SubmittedBy()"></span></td>
                                </tr>
                                <!--<tr data-bind="visible: !IsCAR()">
                                    <td>CAP Approval Status:</td>
                                    <td><span data-bind="text: CAPApprovalStatus()"></span></td>
                                </tr>-->
                                <tr>
                                    <td>Completed Actions:</td>
                                    <td>
                                        <!--<span data-bind="text: NumActions()"></span>:<span data-bind="text: NumOpenActions()"></span>-->

                                        <div class="progress" style="height: 20px">
                                            <div class="progress-bar bg-info" role="progressbar" data-bind="style: {width: ActionPercentage(), color: ActionPercentage() == '0%' ? 'black' : 'white'}, css: ActionProgressBarClass()" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"><span data-bind="text: vm.NumClosedActions() + '/' + vm.NumActions()" /></div>
                                        </div>
                                    </td>
                                </tr>
                                <tr data-bind="visible: ImplementationTargetDate()">
                                    <td>Target Implementation Date:</td>
                                    <td><span data-bind="text: ImplementationTargetDate()"></span></td>
                                </tr>
                                <tr data-bind="visible: ImplementationCompletedDate()">
                                    <td>Implementation Completed Date:</td>
                                    <td><span data-bind="text: ImplementationCompletedDate()"></span></td>
                                </tr>
                                <tr data-bind="visible: EffectivenessVerificationTargetDate()">
                                    <td>Target Verification Date:</td>
                                    <td><span data-bind="text: EffectivenessVerificationTargetDate()"></span></td>
                                </tr>
                                <tr>
                                    <td>
                                        <a data-bind="attr: {href: contactQTM()}">Contact QTM regarding this record.</a>
                                    </td>
                                </tr>
                            </table>
                            <br />
                            <div class="container row">
                                <button type="button" id="buttonEdit" class="btn btn-outline-primary">Edit</button><br />
                                <button type="button" id="buttonClose" data-bind="visible: userCanClose()" class="btn btn-outline-danger">Close</button>
                                <button type="button" id="buttonOpen" class="btn btn-outline-danger">Re-Open</button>

                                <!--<a title='Edit CAP' id="linkeditcap" href='javascript:void(0)'><span class='ui-icon ui-icon-pencil'></span><span>Edit CAP</span><span id="editwarning"></span></a>
                                <span id="editcapwarn" style="color:red;"> Editing the cap will reinitiate the process.</span> -->
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-6">
                    <div class="card">
                        <div class="card-header" style="cursor: pointer" data-toggle="collapse" data-target="#collapseStatus"><h4>Status Legend (click here for more info)</h4></div>
                        <div class="card-body">
                            <div id="divCurrentStatusDesc"></div>
                            <br />
                            <div class="collapse" id="collapseStatus">
                                <table class="table" id="tblStatusLegend">
                                    <thead>
                                        <tr>
                                            <th>Stage</th>
                                            <th>Status</th>
                                            <th>Description</th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <br />
            <div id="divCAPItems">
                <div>
                    <div class="card">
                        <div class="card-header"><h4>Opportunity for Improvement</h4></div>
                        <div class="card-body">
                            <span data-bind="text: OFIDescription()"></span>
                        </div>
                    </div>
                </div>
                <br />
                <div>
                    <div class="card">
                        <div class="card-header"><h4>Data Discovery and Analysis</h4></div>
                        <div class="card-body">
                            <span data-bind="text: DiscoveryDataAnalysis()"></span>
                        </div>
                    </div>
                </div>
            </div>
            <br />
            <div id="divCARItems">
                <div id="cardProblemDescription" class="card">
                    <div class="card-header"><h4>Problem Description</h4></div>
                    <div class="card-body">
                        <p id="pProblemDescription" data-bind="text: ProblemDescription()"></p>
                        <textarea id="textareaProblemDescription" class="form-control" data-bind="textInput: ProblemDescription"></textarea>
                        <br />
                        <!--<button type="button" id="buttonSaveProblemDescription" class="btn btn-outline-secondary">Edit</button>-->
                        <button type="button" id="buttonSaveProblemDescription" class="btn btn-outline-secondary">Save</button>
                        <button type="button" id="buttonEditProblemDescription" class="btn btn-outline-secondary">Edit</button>
                    </div>
                </div>
                <br />
                <div id="cardContainmentAction" class="card">
                    <div class="card-header"><h4>Containment Action</h4></div>
                    <div class="card-body">
                        <b>Description</b>
                        <div id="divDispContainmentAction">
                            <p id="pContainmentAction" data-bind="text: ContainmentAction()"></p>
                            <button type="button" id="buttonEditContainmentAction" class="btn btn-outline-secondary">Edit</button>
                        </div>
                        <div id="divEditContainmentAction">
                            <textarea id="textareaContainmentAction" class="form-control" data-bind="textInput: ContainmentAction"></textarea>
                            <b id="headerContainmentActionDate" class="edit">Containment Action Date</b>
                            <br />
                            <input type="date" id="dateContainmentAction" data-bind="value: moment(ContainmentActionDate()).toISOString()"></input>
                            <br />
                            <button type="button" id="buttonSaveContainmentAction" class="btn btn-outline-secondary">Save</button>
                        </div>
                    </div>
                    <div class="card-footer">
                        Action Date: <span data-bind="text: ContainmentActionDate()"></span>
                    </div>
                </div>
                <br />
                <div id="rootCauseDiv">
                    <div class="card">
                        <div class="card-header"><h4>Root Cause Determination</h4></div>
                        <div class="card-body">
                            <p>
                                Note: Refer to "GFS-RD-QMS-0501 Determining the Root Cause: Simple Problem Solving (5 Why)" or
                                "GFS-RD-QMS-0502 Determining the Root Cause: Complex Problem Solving" to assist in the Root Cause Analysis.
                                This root cause analysis is sometimes called "5 Why" but you may require fewer or more than five "Why" questions.
                            </p>
                            <button type="button" id="buttonNewRootCauseQuestion" class="btn btn-outline-success">New</button>
                            <table id="tblRootCause" class="display" style="width:100%">
                                <thead>
                                    <tr>
                                        <th>#</th>
                                        <th>Question</th>
                                        <th>Answer</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                            <br />
                            <h4>Final Root Cause Determination <span>(Restate the answer to your last "Why" from above)</span>:</h4>
                            <div id="divDispRootCause">
                                <p id="pFinalRootCause" data-bind="text: RootCauseDetermination()"></p>
                                <button type="button" id="buttonEditFinalRootCause" class="btn btn-outline-secondary">Edit</button>
                            </div>
                            <div id="divEditRootCause">
                                <textarea class="form-control" id="textareaFinalRootCause" data-bind="textInput: RootCauseDetermination"></textarea>
                                <br />
                                <button type="button" id="buttonSaveFinalRootCause" class="btn btn-outline-secondary">Save</button>
                            </div>
                        </div>
                    </div>
                </div>
                <br />
                <div class="card" id="cardSimilarNoncomformities">
                    <div class="card-header"><h4>Similar Nonconformities</h4></div>
                    <div class="card-body">
                        <p>Could this nonconformance occur in another one of your office processes or in a corresponding office in another CGFS location?</p>
                        <select id="selectSimilarBool" data-bind="value: SimilarNoncomformityBool(),
                                enable: recordIsUserEditable()">
                            <option value="No">No</option>
                            <option value="Yes">Yes</option>
                        </select>
                        <div id="divSimilarNoncomformityArea">
                            <b>Explanation:<span class="required">*</span></b>
                            <br />
                            <div id="divDispSimilarNoncomformityDesc">
                                <p id="spanSimilarNoncomformityDesc"
                                   data-bind="text: SimilarNoncomformityDesc()"></p>
                                <button type="button" id="buttonEditSimilarNoncomformity" class="btn btn-outline-secondary">Edit</button>
                            </div>
                            <div id="divEditSimilarNoncomformityDesc">
                                <textarea class="form-control"
                                          id="textareaEditSimilarNoncomformityDesc"
                                          data-bind="textInput: SimilarNoncomformityDesc,
                                                style: {'border-color': vm.SimilarNoncomformityDesc().length < 5 ? 'red' : '#ced4da'}"></textarea>
                                <br />
                                <button type="button" id="buttonSaveSimilarNoncomformity" data-bind="disabled: SimilarNoncomformityDesc()" class="btn btn-outline-secondary">Save</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <br />
            <div class="card" id="cardSupportingDocuments">
                <div class="card-header"><h4>Supporting Documents</h4></div>
                <div class="card-body">
                    <div class="alert alert-warning">
                        <b>Notice:</b>
                        <p>Please do not upload PII.</p>
                    </div>
                    <div>
                        <button type="button" id="buttonUploadRequestDoc" class="btn btn-outline-primary">Upload</button>
                        <!--<a id="linkUploadRequestDoc" title="Upload Request Document" href="javascript:void(0)"><span class="ui-icon ui-icon-circle-arrow-n">Upload Request Document</span>Upload Supporting Doc</a>-->
                    </div>
                    <br />
                    <div data-bind="visible: SupportDocuments().length > 0">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Title</th>
                                    <th>File Name</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody data-bind="foreach: SupportDocuments">
                                <tr>
                                    <td data-bind="text: DocumentTitle"></td>
                                    <td><a title="Click to download" data-bind="attr: {href: $root.formatDocDownloadLink($data)}, text: DocumentName.split(';#')[1]" /></td>
                                    <td>
                                        <a title='View Document' href='javascript:void(0)'
                                           data-bind="click: m_fnViewDoc.bind($data)">
                                            <span class='ui-icon ui-icon-search'>View Doc</span>
                                        </a>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <br />
            <div class="card" id="cardActionList">
                <div class="card-header"><h4>Actions List</h4></div>
                <div class="card-body">
                    <div>
                        <button type="button" id="buttonSubmitNewAction" class="btn btn-outline-success">New Action</button>
                        <!--<a id="linkSubmitNewAction" href="javascript:void(0)"><span class='ui-icon ui-icon-plus'></span>Create a New Action</a>-->
                    </div>
                    <div class="empty-table" data-bind="visible: ActionListItems().length == 0">
                        <h2>This record currently has no associated actions. Create a new one.</h2>
                    </div>
                    <!--<table id="tblactions" class="display" style="width:100%">
                        <thead>
                            <tr>
                                <th>Mark Complete</th>
                                <th>Action ID</th>
                                <th>Action Description</th>
                                <th>Previous Target Date</th>
                                <th>Current Target Date</th>
                                <th>Completion Date</th>
                                <th>Implementation Status</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                    </table>-->
                    <div data-bind="visible: vm.ActionListItems().length > 0">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Mark Complete</th>
                                    <th>Action ID</th>
                                    <th>Action Description</th>
                                    <th>Responsible Person</th>
                                    <th>Target Date</th>
                                    <th>Completion Date</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody data-bind="foreach: ActionListItems">
                                <tr>
                                    <td data-bind="">
                                        <button data-bind="enable: actionCompleteEnable($data),
                                                        visible: !actionApproveDisplay($data),
                                                        css: actionCompleteClass($data),
                                                        text: actionCompleteText($data),
                                                        click: actionCompleteClick.bind($data)"
                                                type="button"
                                                class="btn"></button>
                                        <button data-bind="visible: actionApproveDisplay($data),
                                                        click: actionApproveClick.bind($data)"
                                                type="button"
                                                class="btn btn-success">
                                            Approve
                                        </button>
                                        <button data-bind="visible: actionApproveDisplay($data),
                                                        click: actionRejectClick.bind($data)"
                                                type="button"
                                                class="btn btn-danger">
                                            Reject
                                        </button>
                                    </td>
                                    <td data-bind="text: ActionID"></td>
                                    <td data-bind="text: ActionDescription"></td>
                                    <td data-bind="text: ActionResponsiblePerson.userName"></td>
                                    <td data-bind="text: TargetDate ? new Date(TargetDate).format('yyyy-MM-dd') : ''"></td>
                                    <td data-bind="text: ImplementationDate ? new Date(ImplementationDate).format('yyyy-MM-dd') : ''"></td>
                                    <td data-bind="text: ImplementationStatus"></td>
                                    <td data-bind="">
                                        <button type="button"
                                                data-bind="enable: actionEditEnable($data),
                                                        click: $root.actionEditClick.bind($data)"
                                                class="btn btn-outline-secondary">
                                            Edit
                                        </button>
                                        <button type="button"
                                                data-bind="enable: actionExtendEnable($data),
                                                        click: $root.actionExtendClick.bind($data)"
                                                class="btn btn-outline-secondary">
                                            Extend
                                        </button>
                                        <button type="button"
                                                data-bind="click: $root.actionHistoryClick.bind($data)"
                                                class="btn btn-outline-info">
                                            History
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <br /><br />
                    <div>
                        <button type="button" id="" class="mt-auto btn btn-outline-primary buttonSubmitInitial"
                                data-bind="visible: ShowSubmitInitial()">
                            Submit
                        </button>
                    </div>
                </div>
            </div>
            <br />
            <div class="card" id="cardEffectivenessDocuments" data-bind="visible: ShowEffectivenessDocs()">
                <div class="card-header"><h4>Effectiveness Documents</h4></div>
                <div class="card-body">
                    <div class="card">
                        <div class="card-body">
                            <h4>1. Office Risk Impact<span class="required">*</span></h4>
                            <label for="selectOfficeImpactBool">Does this CAR/CAP impact your Office Risks, Mitigations, or Internal Controls?</label>
                            <select id="selectOfficeImpactBool" name="OfficeImpactBool" data-bind="value: OfficeImpactBool, enable: vm.ProcessStage() == 'Pending Effectiveness Submission' || vm.ProcessStage() == 'Pending Effectiveness Submission: Rejected'">
                                <option value="0">No</option>
                                <option value="1">Yes</option>
                            </select>
                            <div>
                                <div id="divDispOfficeImpactDesc">
                                    <p data-bind="text: OfficeImpactDesc()"></p>
                                    <button type="button" id="buttonEditOfficeImpactDesc" class="btn btn-outline-secondary">Edit</button>
                                </div>
                                <div id="divEditOfficeImpactDesc">
                                    <label for="textareaOfficeImpactDesc">Please give a brief explanation.  (Note:  It is the responsibility of the QSO to ensure the Office Risks, Mitigations, and Internal Control document is updated as needed.):<span class="required">*</span></label>
                                    <textarea class="form-control"
                                              id="textareaOfficeImpactDesc"
                                              data-bind="textInput: OfficeImpactDesc,
                                                        style: {'border-color': vm.OfficeImpactDesc().length < 5 ? 'red' : '#ced4da'}"></textarea>
                                    <br />
                                    <button type="button" id="buttonSaveOfficeImpactDesc" class="btn btn-outline-primary">Save</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <br /><br />
                    <div class="card">
                        <div class="card-body">
                            <h4>2. Proof of Effectiveness<span class="required">*</span></h4>
                            <p>Provide a text description using the textarea below, or upload documents by selecting the upload button.</p>
                            <div id="divDispEffectivenessDesc">
                                <p id="pEffectivenessDesc" data-bind="text: EffectivenessDescription()"></p>
                                <button type="button" id="buttonEditEffectivenessDesc" class="btn btn-outline-secondary">Edit</button>
                            </div>
                            <div id="divEditEffectivenessDesc">
                                <textarea class="form-control" id="textareaEffectivenessDesc" data-bind="textInput: EffectivenessDescription"></textarea>
                                <br />
                                <button type="button" id="buttonSaveEffectivenessDesc" class="btn btn-outline-primary">Save</button>
                            </div>
                            <h4>and/or</h4>
                            <div class="alert alert-warning">
                                <b>Notice:</b>
                                <p>Please do not upload PII.</p>
                            </div>
                            <div>
                                <button type="button" id="buttonUploadEffectivenessDoc" class="btn btn-outline-primary">Upload</button>
                                <!--<a title='Upload Effectiveness Document' id="linkUploadEffectivenessDoc" href='javascript:void(0)'><span class='ui-icon ui-icon-circle-arrow-n'></span>Upload Effectiveness Doc</a>-->
                            </div>
                            <br />
                            <div data-bind="visible: EffectivenessDocuments().length > 0">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>Title</th>
                                            <th>File Name</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody data-bind="foreach: EffectivenessDocuments">
                                        <tr>
                                            <td data-bind="text: DocumentTitle"></td>
                                            <td><a title="Click to download" data-bind="attr: {href: $root.formatDocDownloadLink($data)}, text: DocumentName.split(';#')[1]" /></td>
                                            <td>
                                                <a title='View Document' href='javascript:void(0)'
                                                   data-bind="click: m_fnViewDoc.bind($data)">
                                                    <span class='ui-icon ui-icon-search'>View Doc</span>
                                                </a>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <button type="button" id="buttonSubmitEffectiveness2" class="btn btn-outline-primary"
                            data-bind="enable: buttonSubmitEffectivenessEnable(),
                                        visible: ['Pending Effectiveness Submission', 'Pending Effectiveness Submission: Rejected'].indexOf(ProcessStage()) >= 0">
                        Submit
                    </button>
                </div>
            </div>

        </div>
    </div>
    <div id="tabs-2">
        <div>
            <div class="card">
                <div class="card-header"><h4>CAP/CARs Requiring Action</h4></div>
                <div class="card-body">
                    <!--<table id="tblappcap" class="display" style="width:100%">
                        <thead>
                            <tr>
                                <th>CAPID</th>
                                <th>Subject</th>
                                <th>BusinessOffice</th>
                                <th>CGFS Location</th>
                                <th>Submitted Date</th>
                                <th>Submitted By</th>
                                <th>Approval Status</th>
                            </tr>
                        </thead>
                    </table>-->
                    <div class="container empty-table"  data-bind="visible: MyAwaitingActionRecordsArray().length == 0">
                        <h2>You currently have no CARs/CAPs awaiting action.</h2>
                    </div>
                    <div data-bind="visible: MyAwaitingActionRecordsArray().length > 0">
                        <table id="tblMyAwaitingActionRecords" class="display">
                            <thead>
                                <tr>
                                    <th>Item #</th>
                                    <th>Subject</th>
                                    <th data-bind="visible: AdminType">Business Office</th>
                                    <th>CGFS Location</th>
                                    <th>Next Target Date</th>
                                    <th>Submitted By</th>
                                    <th>Status</th>
                                    <th>Type</th>
                                </tr>
                            </thead>
                            <tbody data-bind="foreach: MyAwaitingActionRecordsArray">
                                <tr>
                                    <td><a href="#" data-bind="click: navigateToRecord.bind($data), text: CAPID"></a></td>
                                    <td data-bind="text: Subject"></td>
                                    <td data-bind="visible: $root.AdminType(), text: BusinessOffice.split(';#')[1]"></td>
                                    <td data-bind="text: CGFSLocation"></td>
                                    <td data-bind="text: $root.formatNextTargetDate($data),
                                                style: {'background-color' : $root.highlightOverdue($data)}"></td>
                                    <td data-bind="text: SubmittedBy"></td>
                                    <td data-bind="text: ProcessStage"></td>
                                    <td data-bind="text: RecordType"></td>
                                </tr>
                            </tbody>
                            <tfoot>
                                <tr>
                                    <th>Item #</th>
                                    <th>Subject</th>
                                    <th data-bind="visible: AdminType">Business Office</th>
                                    <th>CGFS Location</th>
                                    <th>Next Target Date</th>
                                    <th>Submitted By</th>
                                    <th>Status</th>
                                    <th>Type</th>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
            </div>
            <br />
            <div class="card" id="cardAwaitingActionList">
                <div class="card-header"><h4>Action Items Requiring Action</h4></div>
                <div class="card-body">
                    <div class="container empty-table" data-bind="visible: ActionsRequiringAction().length == 0">
                        <h2>You currently have no actions awaiting action.</h2>
                    </div>
                    <!--<table id="tblAwaitingActions" class="display" style="width:100%">
                        <thead>
                            <tr>
                                <th>Mark Complete</th>
                                <th>Action ID</th>
                                <th>Action Description</th>
                                <th>Previous Target Date</th>
                                <th>Current Target Date</th>
                                <th>Completion Date</th>
                                <th>Implementation Status</th>
                                <th style="display: none">Action</th>
                            </tr>
                        </thead>
                    </table>-->
		    <div data-bind="visible: ActionsRequiringAction().length > 0">
                    <table id="tblAwaitingAction" class="table">
                        <thead>
                            <tr>
                                <th>Mark Complete</th>
                                <th>Action ID</th>
                                <th>Action Description</th>
                                <th>Responsible Person</th>
                                <th>Target Date</th>
                                <th>Completion Date</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody data-bind="foreach: ActionsRequiringAction">
                            <tr>
                                <td data-bind="">
                                    <button data-bind="click: navigateToRecord.bind($data)"
                                            type="button"
                                            class="btn btn-outline-secondary">
                                        View
                                    </button>
                                </td>
                                <td data-bind="text: ActionID"></td>
                                <td data-bind="text: ActionDescription"></td>
                                <td data-bind="text: ActionResponsiblePerson.userName"></td>
                                <td data-bind="text: TargetDate ? new Date(TargetDate).format('yyyy-MM-dd') : ''"></td>
                                <td data-bind="text: ImplementationDate ? new Date(ImplementationDate).format('yyyy-MM-dd') : ''"></td>
                                <td data-bind="text: ImplementationStatus"></td>
                                <td data-bind="">
                                    <button type="button"
                                            data-bind="click: $root.actionHistoryClick.bind($data)"
                                            class="btn btn-outline-info">
                                        History
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
		    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="tabs-3" style="display: none">
        <div>
            <div id="divDashboard">
                <div class="row">
                    <div class="col-6">
                        <div class="card">
                            <div class="card-body">
                                <canvas id="chartByStatus"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="card">
                            <div class="card-body">
                                <canvas id="chartByLocation"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                <br />
            </div>
            <br />
        </div>
    </div>
    <div id="tabs-4">
        <div class="card">
            <div class="card-header">
                <h3>View All CARs and CAPs</h3>
            </div>

            <div class="card-body">
                <div class="alert alert-info">
                    <p>Select "Update List" below to refresh the latest information about all CARs and CAPs in the system. </p>
                </div>
                <!--<label for="selectOffice">Please select an office:</label>
                <select id="selectOffice" />-->
                <button type="button" id="btnRequestAllRecords" class="btn btn-primary">Update List</button>
                <div data-bind="visible: LookupRecordsArray().length > 0">
                    <table id="tblLookupRecords" class="display">
                        <thead>
                            <tr>
                                <th>Item #</th>
                                <th>Subject</th>
                                <th>Business Office</th>
                                <th>CGFS Location</th>
                                <th>Next Target Date</th>
                                <th>Submitted By</th>
                                <th>Status</th>
                                <th>Type</th>
                            </tr>
                        </thead>
                        <tbody data-bind="foreach: LookupRecordsArray">
                            <tr>
                                <td><a href="#" data-bind="click: navigateToRecord.bind($data), text: CAPID"></a></td>
                                <td data-bind="text: Subject"></td>
                                <td data-bind="text: BusinessOffice.split(';#')[1]"></td>
                                <td data-bind="text: CGFSLocation"></td>
                                <td data-bind="text: $root.formatNextTargetDate($data),
                                                style: {'background-color' : $root.highlightOverdue($data)}"></td>
                                <td data-bind="text: SubmittedBy"></td>
                                <td data-bind="text: ProcessStage"></td>
                                <td data-bind="text: RecordType"></td>
                            </tr>
                        </tbody>
                        <tfoot>
                            <tr>
                                <th>Item #</th>
                                <th>Subject</th>
                                <th>Business Office</th>
                                <th>CGFS Location</th>
                                <th>Next Target Date</th>
                                <th>Submitted By</th>
                                <th>Status</th>
                                <th>Type</th>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <div id="injectAdditionalTabs"></div>
</div>
<div>
    <!-- ko if: currentUserObj.id -->
    <p>User ID: <span data-bind="text: currentUserObj.id"></span></p>
    <!-- /ko -->
</div>
  

<!--<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.3/Chart.min.js"></script>
<script type="text/javascript" src="../SiteAssets/js/app/dash.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/buttons/1.6.1/js/dataTables.buttons.min.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/buttons/1.6.1/js/buttons.colVis.min.js"></script>
-->

<script type="text/javascript" src="../SiteAssets/js/app/app-main.js"></script>


