<!DOCTYPE html>
<script src="/_layouts/15/SP.Runtime.js"></script>
<script src="/_layouts/15/SP.js"></script>
<script src="/_layouts/15/SP.UI.Dialog.js"></script>
<script
  type="text/javascript"
  src="../Apps/_layouts/15/clienttemplates.js"
></script>
<script
  type="text/javascript"
  src="../Apps/_layouts/15/clientforms.js"
></script>
<script
  type="text/javascript"
  src="../Apps/_layouts/15/clientpeoplepicker.js"
></script>
<script type="text/javascript" src="../Apps/_layouts/15/autofill.js"></script>

<script
  language="javascript"
  src="/sites/CGFS-QMS/Style Library/apps/qms-ci/lib/jquery/jquery-3.3.1.min.js"
  type="text/javascript"
></script>

<!-- <link
  rel="stylesheet"
  type="text/css"
  href="/sites/CGFS-QMS/Style Library/apps/qms-ci/lib/jquery-ui-1.13.3.custom/jquery-ui.min.css"
/>
<link
  rel="stylesheet"
  type="text/css"
  href="/sites/CGFS-QMS/Style Library/apps/qms-ci/lib/jquery-ui-1.13.3.custom/jquery-ui.theme.min.css"
/>
<link
  rel="stylesheet"
  type="text/css"
  href="/sites/CGFS-QMS/Style Library/apps/qms-ci/lib/jquery-ui-1.13.3.custom/jquery-ui.structure.min.css"
/>
<script
  language="javascript"
  src="/sites/CGFS-QMS/Style Library/apps/qms-ci/lib/jquery-ui-1.13.3.custom/jquery-ui.min.js"
  type="text/javascript"
></script> -->

<!-- <link
  rel="stylesheet"
  type="text/css"
  href="/sites/CGFS-QMS/Style Library/apps/qms-ci/lib/jquery-ui-1.12.1/redmond/jquery-ui.min.css"
/>
<script
  language="javascript"
  src="/sites/CGFS-QMS/Style Library/apps/qms-ci/lib/jquery-ui-1.12.1/jquery-ui.min.js"
  type="text/javascript"
></script> -->

<link
  rel="stylesheet"
  type="text/css"
  href="/sites/CGFS-QMS/Style Library/apps/qms-ci/lib/bootstrap-5.3.0/css/bootstrap.min.css"
/>
<script
  language="javascript"
  src="/sites/CGFS-QMS/Style Library/apps/qms-ci/lib/bootstrap-5.3.0/js/bootstrap.bundle.min.js"
  type="text/javascript"
></script>

<link
  rel="stylesheet"
  href="/sites/CGFS-QMS/Style Library/apps/qms-ci/lib/fontawesome-6.5.1/css/fontawesome.min.css"
/>
<link
  rel="stylesheet"
  href="/sites/CGFS-QMS/Style Library/apps/qms-ci/lib/fontawesome-6.5.1/css/solid.min.css"
/>

<link
  rel="stylesheet"
  type="text/css"
  href="/sites/CGFS-QMS/Style Library/apps/qms-ci/lib/datatables/datatables.min.css"
/>
<script
  language="javascript"
  src="/sites/CGFS-QMS/Style Library/apps/qms-ci/lib/datatables/dataTables.min.js"
  type="text/javascript"
></script>

<!-- Main Quill library -->
<link
  href="https://cdn.jsdelivr.net/npm/quill@2/dist/quill.snow.css"
  rel="stylesheet"
/>
<script src="https://cdn.jsdelivr.net/npm/quill@2/dist/quill.js"></script>

<script
  type="module"
  src="/sites/CGFS-QMS/Style Library/apps/qms-ci/lib/webcomponents/searchselect/searchselect.js"
></script>

<script
  language="javascript"
  src="/sites/CGFS-QMS/Style Library/apps/qms-ci/lib/knockout/knockout-3.5.1.js"
  type="text/javascript"
></script>

<script
  language="javascript"
  src="/sites/CGFS-QMS/Style Library/apps/qms-ci/dist/common.js"
  type="text/javascript"
></script>

<!-- <script
  language="javascript"
  src="/sites/CGFS-QMS/Style Library/apps/qms-ci/src/vm.js"
  type="module"
></script> -->

<script
  language="javascript"
  src="/sites/CGFS-QMS/Style Library/apps/qms-ci/dist/sal-v2.js"
  type="text/javascript"
></script>

<!-- <link
  rel="stylesheet"
  type="text/css"
  href="/sites/CGFS-QMS/Style Library/apps/qms-ci/lib/tablesorter/style.css"
/> -->

<link
  rel="stylesheet"
  type="text/css"
  href="/sites/CGFS-QMS/Style Library/apps/qms-ci/dist/styles.css"
/>

<div class="app">
  <!-- ko with: blockingTasks -->
  <div class="tasks blocking dimmer" data-bind="css: {'active': $data.length}">
    <span class="loader"></span>
    <ul class="" data-bind="foreach: $data">
      <li data-bind="text: msg + '... ' + Status()"></li>
    </ul>
  </div>
  <!-- /ko -->

  <!-- ko with: runningTasks -->
  <div
    class="tasks running"
    style="display: none"
    data-bind="visible: $data.length"
  >
    <ul class="" data-bind="foreach: $data">
      <li data-bind="text: msg + '... ' + Status()"></li>
    </ul>
  </div>
  <!-- /ko -->

  <!-- ko foreach: app.currentDialogs -->
  <div
    data-bind="component: { name: 'modal-dialog-component', params: $data }"
  ></div>
  <!-- /ko -->
  <div
    id="warnIE"
    class="alert alert-warning"
    role="alert"
    style="display: none"
  >
    It looks like you're using Internet Explorer, for best performance, please
    use Edge or Chrome.
  </div>

  <div id="divLoading" style="color: green; padding-bottom: 10px"></div>

  <div id="showme">
    <p>Please wait... loading.</p>
    <p>This application is currently only supported in Chrome or Edge.</p>
  </div>

  <div id="tabs" class="tabclass" style="display: none">
    <div>
      <div class="mb-2 w-sm">
        <div class="card-body d-flex justify-content-start align-items-center">
          <div>
            <h5 class="m-0 me-2">Current Role:</h5>
          </div>
          <div>
            <select
              class="form-control"
              data-bind="value: AdminType, 
              options: userRoleOpts, 
              optionsText: 'DISPLAYNAME',
              optionsValue: 'ROLE'"
            ></select>
          </div>
        </div>
      </div>
      <!-- <div id="peopleImpersonate" data-bind="people: impersonateUserField"></div> -->
    </div>

    <!-- ko using: tabs -->
    <ul class="ui-tabs-nav" data-bind="foreach: visibleTabs">
      <li
        data-bind="text: linkText, 
                click: $parent.clickTabLink, 
                css: {active: $parent.isSelected($data)}"
      ></li>
    </ul>
    <!-- ko foreach: tabOpts -->
    <div
      data-bind="template: {
                  name: template.id,
                  data: template.data
                },
                visible: $parent.isSelected($data) && visible()"
    ></div>
    <!-- /ko -->
    <!-- /ko -->
    <div class="tab-content">
      <div id="injectAdditionalTabs"></div>
    </div>
  </div>
  <div>
    <!-- ko if: currentUserObj.id -->
    <p>User ID: <span data-bind="text: currentUserObj.id"></span></p>
    <!-- /ko -->
  </div>
</div>

<!-- QTM Tab -->
<script type="text/html" id="tabs-qtm">
  <div class="card" style="padding-bottom: 10px">
    <div class="card-header"><h3>All Open CARs/CAPs</h3></div>
    <div class="card-body">
      <br />
      <div
        class="empty-table"
        data-bind="visible: allOpenRecordsArray().length == 0"
      >
        <h2>There are currently no CARs or CAPs in your office/location.</h2>
      </div>
      <div data-bind="visible: allOpenRecordsArray().length > 0">
        <!-- ko with: allOpenRecordsArray, as: 'allOpenRecordsArray' -->
        <table
          id="tblAllOpenRecords"
          class="table table-striped table-hover w-100"
          data-bind="descendantsComplete: $root.bindingCompleteHandlers.tableBound"
        >
          <thead>
            <tr>
              <th>QTM Action Required</th>
              <th>Item #</th>
              <th>Subject</th>
              <th>Business Office</th>
              <th>CGFS Location</th>
              <th>Next Target Date</th>
              <th>Coordinator</th>
              <th>Status</th>
              <th>Type</th>
            </tr>
            <tr>
              <th data-filter="bool-filter"></th>
              <th data-filter="select-filter"></th>
              <th data-filter="search-filter" column-width="max"></th>
              <th data-filter="select-filter" column-width="max"></th>
              <th data-filter="select-filter"></th>
              <th data-filter="select-filter"></th>
              <th data-filter="select-filter"></th>
              <th data-filter="select-filter"></th>
              <th data-filter="select-filter"></th>
            </tr>
          </thead>
          <tbody data-bind="foreach: allOpenRecordsArray">
            <tr
              data-bind="css: {'requires-attention': $root.filterRequiresQTMAction($data)}"
            >
              <td
                data-bind="text: $root.filterRequiresQTMAction($data) ? 'True': null"
              ></td>
              <td
                class="plan-id"
                data-bind="click: $root.navigateToRecord.bind($data), text: Title"
              ></td>
              <td
                data-bind="text: Common.Utilities.truncateText(Subject, 60), attr: { title: Subject}"
              ></td>
              <td
                class="text-wrap"
                data-bind=" text: BusinessOffice.get_lookupValue()"
              ></td>
              <td data-bind="text: CGFSLocation"></td>
              <td
                data-bind="text: $root.formatNextTargetDate($data),
                                                style: {'background-color' : $root.highlightOverdue($data) }"
              ></td>
              <td data-bind="text: CoordinatorName"></td>
              <td data-bind="text: ProcessStage"></td>
              <td data-bind="text: RecordType"></td>
            </tr>
          </tbody>
          <tfoot></tfoot>
        </table>
        <!-- /ko -->
      </div>
    </div>
  </div>
</script>

<!-- QTMB Tab -->
<script type="text/html" id="tabs-qtmb">
  <div class="card" style="padding-bottom: 10px">
    <div class="card-header"><h3>QTM-B Open CARs/CAPs</h3></div>
    <div class="card-body">
      <!-- <div>
            <button
              id="linkSubmitNewCAP"
              type="button"
              class="btn btn-outline-success"
              data-bind="click: controls.record.new"
            >
              New
            </button>
          </div> -->
      <br />
      <div
        class="empty-table"
        data-bind="visible: qtmbOpenRecordsArray().length == 0"
      >
        <h2>There are currently no CARs or CAPs in your office/location.</h2>
      </div>
      <div
        data-bind="visible: qtmbOpenRecordsArray().length > 0,
        with: qtmbOpenRecordsArray, as: 'qtmbOpenRecordsArray'"
      >
        <table
          id="tblQTMBOpenRecords"
          class="display"
          data-bind="descendantsComplete: $root.bindingCompleteHandlers.tableBound"
        >
          <thead>
            <tr>
              <th>QTMB Action Required</th>
              <th>Item #</th>
              <th>Subject</th>
              <th>Business Office</th>
              <th>CGFS Location</th>
              <th>Next Target Date</th>
              <th>Coordinator</th>
              <th>Status</th>
              <th>Type</th>
            </tr>
            <tr>
              <th data-filter="bool-filter"></th>
              <th data-filter="select-filter"></th>
              <th data-filter="search-filter"></th>
              <th data-filter="select-filter"></th>
              <th data-filter="select-filter"></th>
              <th data-filter="select-filter"></th>
              <th data-filter="select-filter"></th>
              <th data-filter="select-filter"></th>
              <th data-filter="select-filter"></th>
            </tr>
          </thead>
          <tbody data-bind="foreach: qtmbOpenRecordsArray">
            <tr
              data-bind="css: {'requires-attention': $root.filterRequiresQTMBAction($data)}"
            >
              <td
                data-bind="text: $root.filterRequiresQTMBAction($data) ? 'True': null"
              ></td>
              <td
                class="plan-id"
                data-bind="click: $root.navigateToRecord.bind($data), text: Title"
              ></td>
              <td
                data-bind="text: Common.Utilities.truncateText(Subject, 60), attr: { title: Subject}"
              ></td>
              <td data-bind=" text: BusinessOffice.get_lookupValue()"></td>
              <td data-bind="text: CGFSLocation"></td>
              <td
                data-bind="text: $root.formatNextTargetDate($data),
                                                  style: {'background-color' : $root.highlightOverdue($data) }"
              ></td>
              <td data-bind="text: CoordinatorName"></td>
              <td data-bind="text: ProcessStage"></td>
              <td data-bind="text: RecordType"></td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</script>

<!-- My CAR/CAP Tab -->
<script type="text/html" id="tabs-my-plans">
  <div id="injectTab0"></div>
  <div class="card" style="padding-bottom: 10px">
    <div class="card-header"><h3>My CARs/CAPs</h3></div>
    <div class="card-body">
      <div>
        <button
          id=""
          type="button"
          class="btn btn-outline-success"
          data-bind="click: $root.clickNewPlan"
        >
          New
        </button>
      </div>
      <br />
      <div
        class="empty-table"
        data-bind="visible: myOpenRecordsArray().length == 0"
      >
        <h2>You currently have no associated CARs or CAPs.</h2>
      </div>
      <div
        data-bind="visible: myOpenRecordsArray().length > 0,
        with: myOpenRecordsArray, as: 'myOpenRecordsArray'"
      >
        <table
          id="tblMyOpenRecords"
          class="display"
          data-bind="descendantsComplete: $root.bindingCompleteHandlers.tableBound"
        >
          <thead>
            <tr>
              <th>Item #</th>
              <th>Subject</th>
              <th>CGFS Location</th>
              <th>Next Target Date</th>
              <th>Coordinator</th>
              <th>Status</th>
              <th>Type</th>
            </tr>
            <tr>
              <th data-filter="select-filter"></th>
              <th data-filter="search-filter" column-width="max"></th>
              <th data-filter="select-filter"></th>
              <th data-filter="select-filter"></th>
              <th data-filter="select-filter"></th>
              <th data-filter="select-filter" column-width="max"></th>
              <th data-filter="select-filter"></th>
            </tr>
          </thead>
          <tbody data-bind="foreach: myOpenRecordsArray">
            <tr>
              <td
                class="plan-id"
                data-bind="click: $root.navigateToRecord.bind($data), text: Title"
              ></td>
              <td
                data-bind="text: Common.Utilities.truncateText(Subject, 60), attr: { title: Subject}"
              ></td>
              <td data-bind="text: CGFSLocation"></td>
              <td
                data-bind="text: $root.formatNextTargetDate($data),
                    style: {'background-color' : $root.highlightOverdue($data)}"
              ></td>
              <td data-bind="text: CoordinatorName"></td>
              <td data-bind="text: ProcessStage"></td>
              <td data-bind="text: RecordType"></td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</script>

<!-- QO Tab -->
<script
  type="text/html"
  data-bind="visible: AdminType() == ROLES.ADMINTYPE.QO"
  id="tabs-qo"
>
  <!-- ko if:  AdminType() == ROLES.ADMINTYPE.QO -->
  <div class="card" style="padding-bottom: 10px">
    <div class="card-header"><h3>QO Dashboard</h3></div>
    <div class="card-body">
      <div class="empty-table" data-bind="visible: qoOpenRecords().length == 0">
        <h2>There are currently no CARs or CAPs in your office/location.</h2>
      </div>
      <div
        data-bind="visible: qoOpenRecords().length > 0,
        with: qoOpenRecords, as: 'qoOpenRecords'"
      >
        <table
          id="tblQOOpenRecords"
          class="display"
          data-bind="descendantsComplete: $root.bindingCompleteHandlers.tableBound"
        >
          <thead>
            <tr>
              <th>QSO Action<br />Required</th>
              <th>Item #</th>
              <th>Subject</th>
              <th>Business Office</th>
              <th>CGFS Location</th>
              <th>Next Target Date</th>
              <th>Coordinator</th>
              <th>Status</th>
              <th>Type</th>
            </tr>
            <tr>
              <th data-filter="bool-filter"></th>
              <th data-filter="select-filter"></th>
              <th data-filter="search-filter"></th>
              <th data-filter="select-filter"></th>
              <th data-filter="select-filter"></th>
              <th data-filter="select-filter"></th>
              <th data-filter="select-filter"></th>
              <th data-filter="select-filter"></th>
              <th data-filter="select-filter"></th>
            </tr>
          </thead>
          <tbody data-bind="foreach: qoOpenRecords">
            <tr
              data-bind="css: {'requires-attention': $root.filterRequiresQOAction($data)}"
            >
              <td
                data-bind="text: $root.filterRequiresQOAction($data) ? 'True': null"
              ></td>
              <td
                class="plan-id"
                data-bind="click: $root.navigateToRecord.bind($data), text: Title"
              ></td>
              <td
                data-bind="text: Common.Utilities.truncateText(Subject, 60), attr: { title: Subject}"
              ></td>
              <td data-bind=" text: BusinessOffice.get_lookupValue()"></td>
              <td data-bind="text: CGFSLocation"></td>
              <td
                data-bind="text: $root.formatNextTargetDate($data),
                                                style: {'background-color' : $root.highlightOverdue($data) }"
              ></td>
              <td data-bind="text: CoordinatorName"></td>
              <td data-bind="text: ProcessStage"></td>
              <td data-bind="text: RecordType"></td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
  <!-- /ko -->
</script>

<!-- Detail Tab -->
<script type="text/html" id="tabs-detail">
  <div id="datalinkDropDown" style="padding-bottom: 15px" class="row">
    <span>ID: </span>
    <select
      id="ddlCAPID"
      class="form-control"
      title="Select a CAP ID"
      data-bind="value: selectedTitle, options: CAPIDOptions, optionsCaption: '-Select-'"
    ></select>
    <a href="javascript:;"
      ><span id="linkRefresh" class="ui-icon ui-icon-refresh"></span
    ></a>
  </div>
  <!--<div>
                  <button id="linkRefresh" type="button" class="btn btn-outline-success">Refresh</button>
              </div>-->

  <!-- ko if: selectedRecord.isLoaded() -->
  <div id="detailstab" data-bind="">
    <div class="progress" style="height: 30px">
      <div
        class="progress-bar bg-info"
        role="progressbar"
        data-bind="style: {width: ProcessPercentage()}"
        aria-valuenow="25"
        aria-valuemin="0"
        aria-valuemax="100"
      >
        <span data-bind="text: ProcessPercentage"></span>
      </div>
    </div>
    <div id="capProcessStages" class="row">
      <div class="w-25">
        <div class="card w-100">
          <div class="card-header">
            <h4>Stage 1: Initial Submission</h4>
          </div>
          <div
            class="card-body"
            data-bind="visible: controls.pipeline.showStage1()"
          >
            <!-- ko if: controls.showSectionByStageKey('Editing') -->
            Check that the below information is correct before submitting this
            CAR.
            <!-- /ko -->
            <!-- ko if: controls.showSectionByStageKey('ProblemApprovalQTMB') -->
            <div>
              <h3>QTMB Approval</h3>
              <button
                type="button"
                class="mt-auto btn btn-outline-success"
                data-bind="click: controls.stage1.problemApproveQTMB"
              >
                Approve
              </button>
              <button
                type="button"
                class="mt-auto btn btn-outline-danger"
                data-bind="click: controls.rejectStage"
              >
                Reject
              </button>
            </div>
            <!-- /ko -->
            <!-- ko if: controls.showSectionByStageKey('ProblemApprovalQTM') -->
            <div>
              <h3>QTM Approval</h3>
              <button
                type="button"
                class="mt-auto btn btn-outline-success"
                data-bind="click: controls.stage1.problemApproveQTM"
              >
                Approve
              </button>
              <button
                type="button"
                class="mt-auto btn btn-outline-danger"
                data-bind="click: controls.rejectStage"
              >
                Reject
              </button>
            </div>
            <!-- /ko -->
            <!-- ko if: controls.showSectionByStageKey('ProblemApprovalQSO') -->
            <div
              class="alert alert-warning"
              role="alert"
              data-bind="visible: validateStage.stage1.ProblemResolver"
            >
              You must add a CAR/CAP Coordinator to Approve.
              <span><a href="javascript:;">Resolve</a></span>
            </div>
            <div>
              <h3>QSO Approval</h3>
              <button
                type="button"
                class="mt-auto btn btn-outline-success"
                data-bind="enable:  !validateStage.stage1.ProblemResolver(), 
                          click: controls.stage1.problemApproveQSO"
              >
                Approve
              </button>
              <button
                type="button"
                class="mt-auto btn btn-outline-danger"
                data-bind="click: controls.rejectStage"
              >
                Reject
              </button>
            </div>
            <!-- /ko -->
            <!-- ko if: controls.showSectionByStageKey('ProblemApprovalQAO') -->
            <div
              class="alert alert-warning"
              role="alert"
              data-bind="visible: validateStage.stage1.ProblemResolver"
            >
              You must add a CAR/CAP Coordinator to Approve.
              <span><a href="javascript:;">Resolve</a></span>
            </div>
            <div>
              <h3>QAO Approval</h3>
              <button
                type="button"
                class="mt-auto btn btn-outline-success"
                data-bind="enable:  !validateStage.stage1.ProblemResolver(),
                          click: controls.stage1.problemApproveQAO"
              >
                Approve
              </button>
              <button
                type="button"
                class="mt-auto btn btn-outline-danger"
                data-bind="click: controls.rejectStage"
              >
                Reject
              </button>
            </div>
            <!-- /ko -->
          </div>
          <div class="card-footer">
            <p>
              Created:
              <span
                data-bind="text: selectedRecord.Created.date().toDateString()"
              ></span>
            </p>
            <!-- <p
                      data-bind="if: vm.selectedRecord.QSOProblemAdjudication() != 'Pending'"
                    >
                      QSO Action:
                      <span
                        data-bind="text: selectedRecord.QSOProblemAdjudicationDate.date().toDateString()"
                      ></span>
                    </p>
                    <p
                      data-bind="if: vm.selectedRecord.QMSBProblemAdjudication() != 'Pending'"
                    >
                      QTMB Action:
                      <span
                        data-bind="text: selectedRecord.QMSBProblemAdjudicationDate.date().toDateString()"
                      ></span>
                    </p>
                    <p
                      data-bind="if: vm.selectedRecord.QTMProblemAdjudication() != 'Pending'"
                    >
                      QTM Action:
                      <span
                        data-bind="text: selectedRecord.QTMProblemAdjudicationDate.date().toDateString()"
                      ></span>
                    </p> -->
          </div>
        </div>
      </div>
      <div class="w-25">
        <div class="card w-100">
          <div class="card-header">
            <h4>Stage 2: Develop Action Plan</h4>
          </div>
          <div class="" id="">
            <div
              class="card-body"
              data-bind="visible: controls.pipeline.showStage2()"
            >
              <!-- ko if: controls.showSectionByStageKey('DevelopingActionPlan') -->
              <div>
                <div data-bind="">
                  Check that the below information is correct before submitting
                  to the Quality Owner for approval.
                </div>
                <div
                  id="warnAddAction"
                  class="alert alert-warning"
                  role="alert"
                  data-bind="visible: validateStage.stage2.Actions()"
                >
                  You must add at least one action item to submit.
                  <span><a href="javascript:;">Resolve</a></span>
                </div>
                <div
                  id="warnAddContainmentAction"
                  class="alert alert-warning"
                  role="alert"
                  data-bind="visible: validateStage.stage2.ContainmentAction()"
                >
                  You must provide a containment action.
                  <span><a href="javascript:;">Resolve</a></span>
                </div>
                <div
                  id="warnAddWhy"
                  class="alert alert-warning"
                  role="alert"
                  data-bind="visible: validateStage.stage2.RootCauseWhy()"
                >
                  You must have at least one Question and Answer for Root Cause.
                  <span><a href="javascript:;">Resolve</a></span>
                </div>
                <div
                  id="warnAddRootCause"
                  class="alert alert-warning"
                  role="alert"
                  data-bind="visible: validateStage.stage2.RootCause()"
                >
                  You must provide a root cause analysis.
                  <span><a href="javascript:;">Resolve</a></span>
                </div>
                <div
                  id="warnAddSimilarNoncomformity"
                  class="alert alert-warning"
                  role="alert"
                  data-bind="visible: validateStage.stage2.Nonconformity()"
                >
                  You must describe any similar nonconformities.
                  <span><a href="javascript:;">Resolve</a></span>
                </div>
                <!--<label for="buttonSubmitInitial" data-bind="visible: NumActions">Submit the record for approval by clicking the submit button:</label>--><br />
                <button
                  type="button"
                  id="buttonSubmitInitial"
                  class="mt-auto btn btn-outline-primary buttonSubmitInitial"
                  data-bind="enable: controls.stage2.enableSubmitActionPlan(),
                          click: controls.stage2.submitActionPlan"
                >
                  Submit</button
                ><br />
              </div>
              <!-- /ko -->
              <!-- ko if: controls.showSectionByStageKey('PlanApprovalQSO') || controls.showSectionByStageKey('PlanApprovalQSOAction') -->
              <h3>QSO Approval</h3>
              <button
                type="button"
                class="mt-auto btn btn-outline-success"
                data-bind="click: controls.stage2.planApproveQSO"
              >
                Approve
              </button>
              <button
                type="button"
                class="mt-auto btn btn-outline-danger"
                data-bind="click: controls.rejectStage"
              >
                Reject
              </button>
              <!-- /ko -->
              <!-- ko if: controls.showSectionByStageKey('PlanApprovalQSOAction') -->

              <!-- /ko -->
              <!-- ko if: controls.showSectionByStageKey('PlanApprovalQTMB') -->
              <h3>QTMB Approval</h3>
              <button
                type="button"
                class="mt-auto btn btn-outline-success"
                data-bind="click: controls.stage2.planApproveQTMB"
              >
                Approve
              </button>
              <button
                type="button"
                class="mt-auto btn btn-outline-danger"
                data-bind="click: controls.rejectStage"
              >
                Reject
              </button>
              <!-- /ko -->
              <!-- ko if: controls.showSectionByStageKey('PlanApprovalQTM') -->
              <h3>QTM Approval</h3>
              <button
                type="button"
                class="mt-auto btn btn-outline-success"
                data-bind="click: controls.stage2.planApproveQTM"
              >
                Approve
              </button>
              <button
                type="button"
                class="mt-auto btn btn-outline-danger"
                data-bind="click: controls.rejectStage"
              >
                Reject
              </button>
              <!-- /ko -->
            </div>
          </div>
          <!-- ko if: selectedRecord.SubmittedDate.date().getTime() -->
          <div class="card-footer" data-bind="">
            <p>
              Submitted:
              <span
                data-bind="text: selectedRecord.SubmittedDate.date().toDateString()"
              ></span>
            </p>
          </div>
          <!-- <div class="card-footer" data-bind="">
                    <p data-bind="if: vm.selectedRecord.QSOAdjudicationDate()">
                      QSO Action:
                      <span
                        data-bind="text: selectedRecord.QSOAdjudicationDate().toDateString()"
                      ></span>
                    </p>
                  </div>
                  <div class="card-footer" data-bind="">
                    <p
                      data-bind="if: vm.selectedRecord.QMSBApprovalStatus() != 'Pending Approval'"
                    >
                      QTMB Action:
                      <span
                        data-bind="text: selectedRecord.QMSBAdjudicationDate.date().toDateString()"
                      ></span>
                    </p>
                  </div>
                  <div class="card-footer" data-bind="">
                    <p
                      data-bind="if: vm.selectedRecord.QTMApprovalStatus() != 'Pending'"
                    >
                      QTM Action:
                      <span
                        data-bind="text: selectedRecord.QTMAdjudicationDate.date().toDateString()"
                      ></span>
                    </p>
                  </div> -->
          <!-- /ko -->
        </div>
      </div>
      <div class="w-25">
        <div class="card w-100">
          <div class="card-header"><h4>Stage 3: Work Actions</h4></div>

          <div class="" id="">
            <div
              class="card-body"
              data-bind="visible: controls.pipeline.showStage3()"
            >
              <!-- ko if: controls.showSectionByStageKey('ImplementingActionPlan') -->
              <div class="form-group" id="formSubmitImplement">
                <div
                  id="warnCompleteActions"
                  class="alert alert-warning"
                  role="alert"
                  data-bind="visible: validateStage.stage3.CompleteActions()"
                >
                  Complete all actions to submit.
                </div>
                <div
                  id="warnSetVerification"
                  class="alert alert-warning"
                  role="alert"
                  data-bind="visible: validateStage.stage3.VerificationTargetDate()"
                >
                  Set a target effectiveness verification date.
                </div>
                <div
                  id="warnAddSupportingDoc"
                  class="alert alert-info"
                  role="alert"
                  data-bind="visible: validateStage.stage3.AddSupportDoc()"
                >
                  Don't forget to attach supporting documents.
                  <span><a href="javascript:;">Resolve</a></span>
                </div>
                <div data-bind="visible: AdminType() == ''">
                  Once all action items have been completed, submit the record
                  for implementation approval.
                </div>
                <br />
                <div id="divSubmitTargetVerification">
                  <div
                    class="form-field-component"
                    data-bind="component: {
                      name: controls.stage3.targetVerificationDate.components.new, 
                      params: controls.stage3.targetVerificationDate
                    }"
                  ></div>
                  <button
                    type="button"
                    id="buttonSubmitImplement"
                    class="btn btn-outline-primary"
                    data-bind="enable: controls.stage3.enableImplementingActionPlan(),
                              click: controls.stage3.submitImplementActionPlan"
                  >
                    Submit
                  </button>
                </div>
              </div>
              <!-- /ko -->

              <!-- ko if: controls.showSectionByStageKey('ImplementationApproval') -->
              <div>
                <h3>QSO Approval</h3>
                <button
                  type="button"
                  class="mt-auto btn btn-outline-success"
                  data-bind="click: controls.stage3.implementationApproveQSO"
                >
                  Approve
                </button>
                <button
                  type="button"
                  class="mt-auto btn btn-outline-danger"
                  data-bind="click: controls.rejectStage"
                >
                  Reject
                </button>
              </div>
              <!-- /ko -->
            </div>
          </div>
          <!-- ko if: selectedRecord.SubmittedImplementDate.date().getTime() -->
          <div class="card-footer" data-bind="">
            <p>
              Submitted:
              <span
                data-bind="text: selectedRecord.SubmittedImplementDate.date().toDateString()"
              ></span>
            </p>
            <!-- <p
                      data-bind="if: vm.selectedRecord.QSOImplementAdjudication() != 'Pending'"
                    >
                      QSO Action:
                      <span
                        data-bind="text: selectedRecord.QSOImplementAdjudicationDate.date().toDateString()"
                      ></span>
                    </p> -->
          </div>
          <!-- /ko -->
        </div>
      </div>
      <div class="w-25">
        <div class="card w-100">
          <div class="card-header"><h4>Stage 4: Effectiveness</h4></div>
          <div>
            <div
              class="card-body"
              data-bind="visible: controls.pipeline.showStage4()"
            >
              <!-- ko if: controls.showSectionByStageKey('EffectivenessSubmission')() ||
                         controls.showSectionByStageKey('EffectivenessSubmissionRejected')() -->

              <div class="form-group" id="formSubmitEffectiveness">
                <div
                  id="warnAddEffectivenessDoc"
                  class="alert alert-warning"
                  role="alert"
                  data-bind="visible: validateStage.stage4.DescOrDoc"
                >
                  Add proof of effectiveness documents or provide a description
                  to submit.
                </div>
                <div
                  id="warnAddOfficeImpact"
                  class="alert alert-warning"
                  role="alert"
                  data-bind="visible: validateStage.stage4.OfficeImpact"
                >
                  Provide a brief explanation for Office Risk Impact.
                </div>
                <div>
                  Submit the proof of effectiveness for approval from the
                  Quality Owner and Quality Team.
                </div>
                <button
                  type="button"
                  id="buttonSubmitEffectiveness"
                  class="mt-auto btn btn-outline-primary"
                  data-bind="enable: controls.stage4.enableEffectivenessSubmit(),
                              click: controls.stage4.submitEffectiveness"
                >
                  Submit
                </button>
              </div>
              <!-- /ko -->
              <!-- ko if: controls.showSectionByStageKey('EffectivenessApprovalQSO') -->
              <div class="form-group" id="">
                <h3>QSO Approval</h3>
                <button
                  type="button"
                  class="mt-auto btn btn-outline-success mb-2"
                  data-bind="click: controls.stage4.effectivenessApproveQSO"
                >
                  Approve
                </button>
                <div class="input-group mt-2">
                  <select
                    class="form-select"
                    data-bind="value: effectivenessRejectReason"
                  >
                    <option value="Not Effective">Not Effective</option>
                    <option value="Lack of Evidence">Lack of Evidence</option>
                  </select>
                  <button
                    type="button"
                    class="mt-auto btn btn-outline-danger"
                    data-bind="click: controls.rejectStage"
                  >
                    Reject
                  </button>
                </div>
              </div>
              <!-- /ko -->
              <!-- ko if: controls.showSectionByStageKey('EffectivenessApprovalQTM') -->
              <div class="form-group" id="">
                <h3>QTM Approval</h3>
                <button
                  type="button"
                  class="mt-auto btn btn-outline-success"
                  data-bind="click: controls.stage4.effectivenessApproveQTM"
                >
                  Approve
                </button>
                <div class="input-group mt-2">
                  <select
                    class="form-select"
                    data-bind="value: effectivenessRejectReason"
                  >
                    <option value="Not Effective">Not Effective</option>
                    <option value="Lack of Evidence">Lack of Evidence</option>
                  </select>
                  <button
                    type="button"
                    class="mt-auto btn btn-outline-danger"
                    data-bind="click: controls.rejectStage"
                  >
                    Reject
                  </button>
                </div>
              </div>
              <!-- /ko -->
              <!-- ko if: controls.showSectionByStageKey('EffectivenessApprovalQTMB') -->
              <div class="form-group" id="">
                <h3>QTMB Approval</h3>
                <button
                  type="button"
                  class="mt-auto btn btn-outline-success"
                  data-bind="click: controls.stage4.effectivenessApproveQTMB"
                >
                  Approve
                </button>
                <div class="input-group mt-2">
                  <select
                    class="form-select"
                    data-bind="value: effectivenessRejectReason"
                  >
                    <option value="Not Effective">Not Effective</option>
                    <option value="Lack of Evidence">Lack of Evidence</option>
                  </select>
                  <button
                    type="button"
                    class="mt-auto btn btn-outline-danger"
                    data-bind="click: controls.rejectStage"
                  >
                    Reject
                  </button>
                </div>
              </div>
              <!-- /ko -->
              <!--a <title='Submit for Effectiveness Approval' href='javascript:void(0)'><span class='ui-icon ui-icon-ok'></span>Submit for Effectiveness Approval</a>-->
            </div>
          </div>
          <div
            class="card-footer"
            data-bind="visible: selectedRecord.SubmittedEffectivenessDate.dateFormat()"
          >
            <p>
              Submitted:
              <span
                data-bind="text: selectedRecord.SubmittedEffectivenessDate.date().toDateString()"
              ></span>
            </p>
            <!-- <p
                      data-bind="if: vm.selectedRecord.QSOEffectivenessAdjudication() != 'Pending'"
                    >
                      QSO Action:
                      <span
                        data-bind="text: selectedRecord.QSOEffectivenessAdjudicationDate.date().toDateString()"
                      ></span>
                    </p>
                    <p
                      data-bind="if: vm.selectedRecord.QMSBEffectivenessAdjudication() != 'Pending'"
                    >
                      QTMB Action:
                      <span
                        data-bind="text: selectedRecord.QMSBEffectivenessAdjudicationDate.date().toDateString()"
                      ></span>
                    </p>
                    <p
                      data-bind="if: vm.selectedRecord.QTMEffectivenessAdjudication() != 'Pending'"
                    >
                      QTM Action:
                      <span
                        data-bind="text: selectedRecord.QTMEffectivenessAdjudicationDate.date().toDateString()"
                      ></span>
                    </p> -->
          </div>
        </div>
      </div>
    </div>
    <div class="modal" id="rejectionInformation">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="title">Reject Reason</h5>
          </div>
          <div class="modal-body">
            <p>Please provide a reject reason:</p>
            <textarea
              class="container-fluid"
              data-bind="value: rejectReason"
            ></textarea>
            <!-- ko if: controls.pipeline.showStage4() -->
            <select data-bind="value: effectivenessRejectReason">
              <option value="Not Effective">Not Effective</option>
              <option value="Lack of Evidence">Lack of Evidence</option>
            </select>
            <!-- /ko -->
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Close
            </button>
            <button
              type="button"
              class="btn btn-danger"
              data-bind="click: controls.rejectStageSubmit"
              data-bs-dismiss="modal"
            >
              Reject
            </button>
          </div>
        </div>
      </div>
    </div>
    <div id="injectTab1"></div>
    <br />
    <div class="row">
      <div class="col-6">
        <div id="divWarnings">
          <div
            class="alert alert-warning"
            data-bind="visible: selectedRecord.ExtensionRequested()"
          >
            Extension Requested Pending
            <span
              data-bind="text: controls.record.extension.extensionApprover"
            ></span>
            Approval
          </div>
          <div
            class="alert alert-warning"
            data-bind="visible: !selectedRecord.Active() && selectedRecord.CancelReason()"
          >
            <b>Reason for Closing:</b>
            <div data-bind="html: selectedRecord.CancelReason()"></div>
          </div>
        </div>
        <div id="divRejections" data-bind="foreach: Rejections">
          <div
            class="alert"
            role="alert"
            data-bind="css: {'alert-info': !Active, 'alert-danger': Active}"
          >
            <div
              class="d-flex justify-content-between align-items-center"
              title="Click to show/hide rejction reason."
              style="cursor: pointer"
              data-bs-toggle="collapse"
              data-bind="attr: {'data-bs-target': '#collapse' + $index()},
              css: {'collapsed': !Active}"
            >
              <div>
                <h4 class="m-0">
                  Rejected:
                  <span data-bind="text: Stage"></span>
                  <span data-bind="text: Active ? '' : '(Resolved)'"></span>
                </h4>
                <p>Date: <span data-bind="text: Date.toDateString()"></span></p>
              </div>
              <i
                class="m-2 fa-solid fa-chevron-up fa-xl collapse-indicator"
              ></i>
            </div>
            <div
              class="collapse"
              data-bind="attr: {id: 'collapse' + $index()}, 
                    css: {'alert-info': !Active, 'alert-danger': Active, 'show': Active}"
            >
              <p data-bind="text: Reason"></p>
              <br />
              <p>Rejector: <span data-bind="text: Rejector"></span></p>
            </div>
          </div>
        </div>
        <div id="divInformation">
          <h3>Information - <span data-bind="text: selectedTitle"></span></h3>
          <h4>
            Current Status: Stage
            <span
              data-bind="text: selectedRecord.ProcessStageObj().stageNum"
            ></span>
            -
            <span data-bind="text: selectedRecord.ProcessStage()"></span>
          </h4>
          <!-- ko if: selectedRecord.Active() -->
          <h4 class="info-row-spread">
            Next Target Date:
            <span
              data-bind="text: vm.selectedRecord.NextTargetDate.date().getTime() ? 
                                  vm.selectedRecord.NextTargetDate.date().toDateString() : 'N/A'"
            ></span>
            <!-- ko if: vm.AdminType() == ROLES.ADMINTYPE.QTM -->
            <a href="javascript:;">
              <span
                class="ui-icon ui-icon-refresh"
                data-bind="click: vm.controls.record.calculateNextTargetDate.bind()"
              ></span>
            </a>
            <!-- /ko -->
          </h4>
          <!-- /ko -->
          <!-- ko ifnot: selectedRecord.Active() -->
          <h4 class="info-row-spread">
            Close Date:
            <span
              data-bind="text: vm.selectedRecord.CloseDate.date().getTime() ? 
                                  vm.selectedRecord.CloseDate.date().toDateString() : 'N/A'"
            ></span>
          </h4>
          <!-- /ko -->
          <div>
            <table id="tblcap4" class="table">
              <tbody>
                <!-- ko with: selectedPlan -->
                <tr>
                  <td>Subject:</td>
                  <td>
                    <span data-bind="text: Subject.toString()"></span>
                  </td>
                </tr>
                <tr>
                  <td>BusinessOffice:</td>
                  <td>
                    <span data-bind="text: BusinessOffice.toString()"></span>
                  </td>
                </tr>
                <tr>
                  <td>CGFS Location:</td>
                  <td>
                    <span data-bind="text: CGFSLocation.toString()"></span>
                  </td>
                </tr>
                <tr>
                  <td>QSO:</td>
                  <td data-bind="">
                    <span data-bind="text: QSOName.toString()"></span>
                  </td>
                </tr>
                <tr>
                  <td>QAO:</td>
                  <td>
                    <span data-bind="text: QAOName.toString()"></span>
                  </td>
                </tr>
                <tr>
                  <td>Source:</td>
                  <td>
                    <span data-bind="text: Source.toString()"></span>
                  </td>
                </tr>
                <tr data-bind="visible: isCAR()">
                  <td>Self-Initiated:</td>
                  <td>
                    <span data-bind="text: SelfInitiated.toString()"></span>
                  </td>
                </tr>
                <!-- /ko -->
                <tr id="trProblemResolver">
                  <td>CAR/CAP Coordinator:</td>
                  <td>
                    <!-- ko if: !section.Info.coordinator.isEditing() -->
                    <span
                      data-bind="text: selectedPlan()?.CoordinatorName.toString()"
                    >
                    </span>
                    <!-- ko if: section.Info.coordinator.isEditable() -->
                    <button
                      type="button"
                      class="btn btn-primary"
                      data-bind="click: section.Info.coordinator.edit"
                    >
                      Edit
                    </button>
                    <!-- /ko -->
                    <!-- /ko -->
                    <!-- ko if: section.Info.coordinator.isEditing() -->
                    <div
                      id="peopleTempCoordinator"
                      data-bind="component: {
                      name: section.Info.coordinator.tempCoordinator.components.edit,
                      params: section.Info.coordinator.tempCoordinator}"
                      class="form-field-component"
                    ></div>
                    <button
                      type="button"
                      class="btn btn-success"
                      data-bind="click: section.Info.coordinator.save"
                    >
                      Save
                    </button>
                    <button
                      type="button"
                      class="btn btn-danger"
                      data-bind="click: section.Info.coordinator.cancel"
                    >
                      Cancel
                    </button>
                    <!-- /ko -->
                    <!-- <div
                                              id="peopleRecordCoordinator"
                                              class="editable-field"
                                              data-bind="people: selectedRecordObj.ProblemResolverName"
                                              ></div> -->
                  </td>
                </tr>
                <!-- ko if: selectedRecord.SubmittedDate.date().getTime() -->
                <tr data-bind="">
                  <td>Submitted Date:</td>
                  <td>
                    <span
                      data-bind="text: selectedRecord.SubmittedDate.date().toDateString()"
                    ></span>
                  </td>
                </tr>
                <!-- /ko -->
                <tr>
                  <td>Submitted By:</td>
                  <td>
                    <span
                      data-bind="text: selectedRecord.Author.getValueForHuman()"
                    ></span>
                  </td>
                </tr>
                <tr>
                  <td>Completed Actions:</td>
                  <td>
                    <!--<span data-bind="text: NumActions()"></span>:<span data-bind="text: NumOpenActions()"></span>-->

                    <div class="progress" style="height: 20px">
                      <div
                        class="progress-bar bg-info"
                        role="progressbar"
                        data-bind="style: {width: ActionPercentage(), color: ActionPercentage() == '0%' ? 'black' : 'white'}, 
                                                  css: ActionProgressBarClass()"
                        aria-valuenow="25"
                        aria-valuemin="0"
                        aria-valuemax="100"
                      >
                        <span
                          data-bind="text: vm.NumClosedActions() + '/' + vm.NumActions()"
                        ></span>
                      </div>
                    </div>
                  </td>
                </tr>
                <tr>
                  <td>Extension Count:</td>
                  <td>
                    <span
                      data-bind="text: selectedRecord.ExtensionCount()"
                    ></span>
                    <!-- ko if: controls.record.extension.showExtensionRequestSection() -->
                    <!-- ko if: !selectedRecord.ExtensionRequested() -->
                    <button
                      type="button"
                      class="btn btn-outline-success"
                      data-bind="click: controls.record.extension.requestExtension"
                    >
                      Request Extension
                    </button>
                    <!-- /ko -->
                    <!-- ko if: selectedRecord.ExtensionRequested() -->
                    <button
                      type="button"
                      class="btn btn-outline-danger"
                      data-bind="click: controls.record.extension.cancelRequest"
                    >
                      Cancel Extension Request
                    </button>
                    <!-- /ko  -->
                    <!-- /ko -->
                    <!-- ko if: controls.record.extension.showApproval() -->
                    <div class="card" style="width: 20rem">
                      <div class="card-body">
                        <h5 class="card-title">
                          <span
                            data-bind="text: controls.record.extension.extensionApprover"
                          ></span>
                          Extension Approval
                        </h5>

                        <div class="content">
                          <button
                            type="button"
                            class="mt-auto btn btn-outline-success"
                            data-bind="click: controls.record.extension.approveRequest"
                          >
                            Approve
                          </button>
                          <button
                            type="button"
                            class="mt-auto btn bottom attached btn-outline-danger"
                            data-bind="click: controls.record.extension.cancelRequest"
                          >
                            Reject
                          </button>
                        </div>
                      </div>
                    </div>
                    <!-- /ko -->
                  </td>
                </tr>
                <tr>
                  <td>Target Implementation Date:</td>
                  <td>
                    <div class="info-row-spread">
                      <!-- ko if: selectedRecord.ImplementationTargetDate.date().getTime() -->
                      <div
                        data-bind="text: selectedRecord.ImplementationTargetDate.date().toDateString()"
                      ></div>
                      <!-- /ko -->
                      <!-- ko if: vm.AdminType() == ROLES.ADMINTYPE.QTM -->
                      <a href="javascript:;">
                        <span
                          class="ui-icon ui-icon-refresh"
                          data-bind="click: $root.controls.record.updateImplementationDate.bind()"
                        ></span>
                      </a>
                      <!-- /ko -->
                    </div>
                  </td>
                </tr>
                <tr data-bind="">
                  <td>Target Verification Date:</td>
                  <td>
                    <!-- ko if: vm.selectedRecord.EffectivenessVerificationTargetD.date().getTime() -->
                    <span
                      data-bind="text: selectedRecord.EffectivenessVerificationTargetD.date().toDateString()"
                    ></span>
                    <!-- /ko -->
                  </td>
                </tr>
                <tr>
                  <td>
                    <a
                      style="color: #007bff"
                      data-bind="attr: {href: contactQTM()}"
                      >Contact QTM regarding this record.</a
                    >
                  </td>
                  <td>
                    <a
                      style="color: #007bff"
                      data-bind="attr: {href: printUrl()}"
                      target="_blank"
                      >View a Print Friendly Version.</a
                    >
                  </td>
                </tr>
              </tbody>
            </table>
            <br />
            <div class="container row d-flex flex-col gap-2">
              <button
                type="button"
                class="btn btn-outline-primary"
                data-bind="click: $root.clickSendStageNotification"
              >
                Resend Stage notification
              </button>
              <button
                type="button"
                class="btn btn-outline-primary"
                data-bind="click: controls.record.view"
              >
                View
              </button>
              <!-- ko if: controls.record.isEditable() -->
              <button
                type="button"
                class="btn btn-outline-primary"
                data-bind="click: controls.record.edit"
              >
                Edit
              </button>
              <!-- /ko -->
              <!-- ko if: controls.record.isCloseable() -->
              <button
                type="button"
                id="buttonClose"
                data-bind="click: controls.record.displayCloseDialog"
                class="btn btn-outline-danger"
              >
                Cancel Plan
              </button>
              <!-- /ko -->
              <!-- ko if: controls.record.isOpenable() -->
              <button
                type="button"
                id="buttonOpen"
                data-bind="click: controls.record.open"
                class="btn btn-outline-success"
              >
                Re-Open
              </button>
              <!-- /ko -->
            </div>
          </div>
        </div>
      </div>
      <div class="col-6">
        <div class="card">
          <div
            class="card-header"
            style="cursor: pointer"
            data-bs-toggle="collapse"
            data-bs-target="#collapseStatus"
            role="button"
          >
            <h4>Status Legend (Click Here for more Info)</h4>
          </div>
          <div class="card-body">
            <div
              id="divCurrentStatusDesc"
              data-bind="text: selectedRecord.ProcessStageObj()?.description"
            ></div>
            <br />
            <div class="collapse" id="collapseStatus">
              <table class="table" id="tblStatusLegend">
                <thead>
                  <tr>
                    <th>Stage</th>
                    <th>Status</th>
                    <th>Description</th>
                  </tr>
                </thead>
                <tbody data-bind="foreach: stageDescriptionsArray">
                  <tr
                    data-bind="css: {'table-info': $parent.selectedRecord.ProcessStageObj()?.stage == stage}"
                  >
                    <td data-bind="text:stageNum"></td>
                    <td data-bind="text:stage"></td>
                    <td data-bind="text:description"></td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
        <br />
        <!-- ko if: selectedRecord.SelfInitiated() == 'No' -->
        <div>
          <h4>Stage 1: Problem Approval History</h4>
          <table class="table approval-history">
            <tbody>
              <tr>
                <td>QSO Problem Approval:</td>
                <td>
                  <div class="info-row-spread">
                    <div
                      data-bind="text: selectedRecord.QSOProblemAdjudication"
                    ></div>
                    <span
                      data-bind="visible: selectedRecord.QSOProblemAdjudicationDate.date().getTime(),
                                    text: selectedRecord.QSOProblemAdjudicationDate.date().toDateString()"
                    ></span>
                  </div>
                </td>
              </tr>
              <!-- ko if: selectedRecord.CGFSLocation() == 'Bangkok' -->
              <tr>
                <td>QTM Bangkok Problem Approval:</td>
                <td>
                  <div class="info-row-spread">
                    <div
                      data-bind="text: selectedRecord.QMSBProblemAdjudication"
                    ></div>
                    <span
                      data-bind="visible: selectedRecord.QMSBProblemAdjudicationDate.date().getTime(),
                                    text: selectedRecord.QMSBProblemAdjudicationDate.date().toDateString()"
                    ></span>
                  </div>
                </td>
              </tr>
              <!-- /ko -->
              <tr>
                <td>QTM Problem Approval:</td>
                <td>
                  <div class="info-row-spread">
                    <div
                      data-bind="text: selectedRecord.QTMProblemAdjudication"
                    ></div>
                    <span
                      data-bind="visible: selectedRecord.QTMProblemAdjudicationDate.date().getTime(),
                                    text: selectedRecord.QTMProblemAdjudicationDate.date().toDateString()"
                    ></span>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <!-- /ko -->
        <!-- ko if: vm.selectedRecord.ProcessStageObj().stageNum >= 2 -->
        <div>
          <h4>Stage 2: Plan Approval History</h4>
          <table class="table approval-history">
            <tbody>
              <tr>
                <td>QSO Plan Approval:</td>
                <td>
                  <div class="info-row-spread">
                    <div
                      data-bind="text: selectedRecord.QSOApprovalStatus"
                    ></div>
                    <span
                      data-bind="visible: selectedRecord.QSOAdjudicationDate.date().getTime(),
                                    text: selectedRecord.QSOAdjudicationDate.date().toDateString()"
                    ></span>
                  </div>
                </td>
              </tr>
              <!-- ko if: selectedRecord.CGFSLocation() == 'Bangkok' -->
              <tr>
                <td>QTM Bangkok Plan Approval:</td>
                <td>
                  <div class="info-row-spread">
                    <div
                      data-bind="text: selectedRecord.QMSBApprovalStatus"
                    ></div>
                    <span
                      data-bind="visible: selectedRecord.QMSBAdjudicationDate.date().getTime(),
                                    text: selectedRecord.QMSBAdjudicationDate.date().toDateString()"
                    ></span>
                  </div>
                </td>
              </tr>
              <!-- /ko -->
              <tr>
                <td>QTM Plan Approval:</td>
                <td>
                  <div class="info-row-spread">
                    <div
                      data-bind="text: selectedRecord.QTMApprovalStatus"
                    ></div>
                    <span
                      data-bind="visible: selectedRecord.QTMAdjudicationDate.date().getTime(),
                                    text: selectedRecord.QTMAdjudicationDate.date().toDateString()"
                    ></span>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <!-- /ko -->
        <!-- ko if: vm.selectedRecord.ProcessStageObj().stageNum >= 3 -->
        <div>
          <h4>Stage 3: Implemenation Approval History</h4>
          <table class="table approval-history">
            <tbody>
              <tr>
                <td>QSO Implementation Approval:</td>
                <td>
                  <div class="info-row-spread">
                    <div
                      data-bind="text: selectedRecord.QSOImplementAdjudication"
                    ></div>
                    <span
                      data-bind="visible: selectedRecord.QSOImplementAdjudicationDate.date().getTime(),
                          text: selectedRecord.QSOImplementAdjudicationDate.date().toDateString()"
                    ></span>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <!-- /ko -->
        <!-- ko if: vm.selectedRecord.ProcessStageObj().stageNum >= 4 -->
        <div>
          <h4>Stage 4: Effectiveness Approval History</h4>
          <table class="table approval-history">
            <tbody>
              <tr>
                <td>QSO Effectiveness Approval:</td>
                <td>
                  <div class="info-row-spread">
                    <div
                      data-bind="text: selectedRecord.QSOEffectivenessAdjudication"
                    ></div>
                    <span
                      data-bind="visible: selectedRecord.QSOEffectivenessAdjudicationDate.date().getTime(),
                                          text: selectedRecord.QSOEffectivenessAdjudicationDate.date().toDateString()"
                    ></span>
                  </div>
                </td>
              </tr>
              <!-- ko if: selectedRecord.CGFSLocation() == 'Bangkok' -->
              <tr>
                <td>QTM Bangkok Effectiveness Approval:</td>
                <td>
                  <div class="info-row-spread">
                    <div
                      data-bind="text: selectedRecord.QMSBEffectivenessAdjudication"
                    ></div>
                    <span
                      data-bind="visible: selectedRecord.QMSBEffectivenessAdjudicationDat.date().getTime(),
                                          text: selectedRecord.QMSBEffectivenessAdjudicationDat.date().toDateString()"
                    ></span>
                  </div>
                </td>
              </tr>
              <!-- /ko -->
              <tr>
                <td>QTM Effectiveness Approval:</td>
                <td>
                  <div class="info-row-spread">
                    <div
                      data-bind="text: selectedRecord.QTMEffectivenessAdjudication"
                    ></div>
                    <span
                      data-bind="visible: selectedRecord.QTMEffectivenessAdjudicationDate.date().getTime(),
                                          text: selectedRecord.QTMEffectivenessAdjudicationDate.date().toDateString()"
                    ></span>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <!-- /ko -->
      </div>
    </div>
    <br />
    <!-- ko if: !IsCAR() -->
    <div id="divCAPItems">
      <div>
        <div class="card">
          <div class="card-header">
            <h4>Opportunity for Improvement</h4>
          </div>
          <div class="card-body">
            <!-- ko ifnot: section.OpportunityForImprovement.isEditing() -->
            <p
              id="pProblemDescription"
              data-bind="html: selectedRecord.OFIDescription()
                        visible: !section.OpportunityForImprovement.isEditing()"
            ></p>
            <button
              type="button"
              id="buttonEditProblemDescription"
              class="btn btn-outline-secondary"
              data-bind="visible: section.OpportunityForImprovement.isEditable(),
                        click: section.OpportunityForImprovement.edit"
            >
              Edit
            </button>
            <!-- /ko -->
            <!-- ko if: section.OpportunityForImprovement.isEditing() -->
            <div
              data-bind="component: { 
              name: section.OpportunityForImprovement.field.components.edit, 
              params: section.OpportunityForImprovement.field}"
            ></div>
            <br />
            <button
              type="button"
              id=""
              class="btn btn-outline-secondary"
              data-bind="click: section.OpportunityForImprovement.save"
            >
              Save
            </button>
            <button
              type="button"
              id=""
              class="btn btn-outline-danger"
              data-bind="click: section.OpportunityForImprovement.cancel"
            >
              Cancel
            </button>
            <!-- /ko -->
          </div>
        </div>
      </div>
      <br />
      <div>
        <div class="card">
          <div class="card-header">
            <h4>Data Discovery and Analysis</h4>
          </div>
          <div class="card-body">
            <!-- ko ifnot: section.DiscoveryDataAnalysis.isEditing() -->
            <p
              id="pProblemDescription"
              data-bind="html: selectedRecord.DiscoveryDataAnalysis()
                       visible: !section.DiscoveryDataAnalysis.isEditing()"
            ></p>
            <button
              type="button"
              id="buttonEditProblemDescription"
              class="btn btn-outline-secondary"
              data-bind="visible: section.DiscoveryDataAnalysis.isEditable(),
                       click: section.DiscoveryDataAnalysis.edit"
            >
              Edit
            </button>
            <!-- /ko -->
            <!-- ko if: section.DiscoveryDataAnalysis.isEditing() -->
            <div
              data-bind="component: { 
              name: section.DiscoveryDataAnalysis.field.components.edit, 
              params: section.DiscoveryDataAnalysis.field}"
            ></div>
            <br />
            <button
              type="button"
              id=""
              class="btn btn-outline-secondary"
              data-bind="click: section.DiscoveryDataAnalysis.save"
            >
              Save
            </button>
            <button
              type="button"
              id=""
              class="btn btn-outline-danger"
              data-bind="click: section.DiscoveryDataAnalysis.cancel"
            >
              Cancel
            </button>
            <!-- /ko -->
          </div>
        </div>
      </div>
    </div>
    <!-- /ko -->
    <br />
    <!-- ko if: IsCAR() -->
    <div id="divCARItems">
      <div id="cardProblemDescription" class="card">
        <div class="card-header"><h4>Problem Description</h4></div>
        <div class="card-body">
          <!-- ko ifnot: section.ProblemDescription.isEditing() -->
          <p
            id="pProblemDescription"
            data-bind="html: selectedRecord.ProblemDescription()
                    visible: !section.ProblemDescription.isEditing()"
          ></p>
          <button
            type="button"
            id="buttonEditProblemDescription"
            class="btn btn-outline-secondary"
            data-bind="visible: section.ProblemDescription.isEditable(),
                    click: section.ProblemDescription.edit"
          >
            Edit
          </button>
          <!-- /ko -->
          <!-- ko if: section.ProblemDescription.isEditing() -->
          <div
            data-bind="component: { 
              name: section.ProblemDescription.field.components.edit, 
              params: section.ProblemDescription.field}"
          ></div>
          <br />
          <button
            type="button"
            id="buttonSaveProblemDescription"
            class="btn btn-outline-secondary"
            data-bind="click: section.ProblemDescription.save"
          >
            Save
          </button>
          <button
            type="button"
            id="buttonSaveProblemDescription"
            class="btn btn-outline-danger"
            data-bind="click: section.ProblemDescription.cancel"
          >
            Cancel
          </button>
          <!-- /ko -->
        </div>
      </div>
      <br />
      <!-- ko if: section.ContainmentAction.isVisible -->
      <div id="cardContainmentAction" class="card">
        <div class="card-header"><h4>Containment Action</h4></div>
        <div class="card-body">
          <b>Description</b>
          <!-- ko ifnot: section.ContainmentAction.isEditing() -->
          <div id="divDispContainmentAction">
            <p
              id="pContainmentAction"
              data-bind="html: selectedRecord.ContainmentAction()"
            ></p>
            <button
              type="button"
              id="buttonEditContainmentAction"
              class="btn btn-outline-secondary"
              data-bind="visible: section.ContainmentAction.isEditable(),
                        click: section.ContainmentAction.edit"
            >
              Edit
            </button>
          </div>
          <!-- /ko -->
          <!-- ko if: section.ContainmentAction.isEditing() -->
          <div id="divEditContainmentAction">
            <div
              data-bind="component: { 
                name: section.ContainmentAction.field.components.edit, 
                params: section.ContainmentAction.field}"
            ></div>
            <b id="headerContainmentActionDate" class="edit"
              >Containment Action Date</b
            >
            <br />
            <div
              data-bind="component: { 
                name: section.ContainmentAction.actionDate.components.edit, 
                params: section.ContainmentAction.actionDate}"
            ></div>
            <br />
            <button
              type="button"
              id="buttonSaveContainmentAction"
              class="btn btn-outline-secondary"
              data-bind="click: section.ContainmentAction.save"
            >
              Save
            </button>
            <button
              type="button"
              id="buttonSaveProblemDescription"
              class="btn btn-outline-danger"
              data-bind="click: section.ContainmentAction.cancel"
            >
              Cancel
            </button>
          </div>
          <!-- /ko -->
        </div>
        <div class="card-footer">
          Containment Action Date:
          <span
            data-bind="text: selectedRecord.ContainmentActionDate.dateFormat()"
          ></span>
        </div>
      </div>
      <!-- /ko -->
      <!-- ko if: controls.showSectionByStageNum(2) -->
      <br />
      <div id="rootCauseDiv">
        <div class="card">
          <div class="card-header"><h4>Root Cause Determination</h4></div>
          <div class="card-body">
            <p>
              Note: Refer to "GFS-RD-QMS-0501 Determining the Root Cause: Simple
              Problem Solving (5 Why)" or "GFS-RD-QMS-0502 Determining the Root
              Cause: Complex Problem Solving" to assist in the Root Cause
              Analysis. This root cause analysis is sometimes called "5 Why" but
              you may require fewer or more than five "Why" questions.
            </p>
            <!-- ko if: section.RootCause.isEditable() -->
            <button
              type="button"
              id="buttonNewRootCauseQuestion"
              class="btn btn-outline-success"
              data-bind="click: section.RootCause.new"
            >
              New
            </button>
            <!-- /ko -->
            <table id="tblRootCause" class="display" style="width: 100%">
              <thead>
                <tr>
                  <th>#</th>
                  <th>Question</th>
                  <th>Answer</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody data-bind="foreach: RootCauseWhy">
                <tr>
                  <td data-bind="text: Number"></td>
                  <td data-bind="text: Question"></td>
                  <td data-bind="text: Answer"></td>
                  <td>
                    <button
                      type="button"
                      class="btn btn-outline-secondary"
                      data-bind="visible: $root.section.RootCause.isEditable(),
                            click: $root.section.RootCause.editWhy.bind($data)"
                    >
                      Edit
                    </button>
                  </td>
                </tr>
              </tbody>
            </table>
            <br />
            <h4>
              Final Root Cause Determination
              <span>(Restate the answer to your last "Why" from above)</span>:
            </h4>
            <!-- ko ifnot: section.RootCause.isEditing() -->
            <div id="divDispRootCause">
              <p
                id="pFinalRootCause"
                data-bind="text: selectedRecord.RootCauseDetermination()"
              ></p>
              <button
                type="button"
                id="buttonEditFinalRootCause"
                class="btn btn-outline-secondary"
                data-bind="visible: section.RootCause.isEditable(),
                          click: section.RootCause.edit"
              >
                Edit
              </button>
            </div>
            <!-- /ko -->
            <!-- ko if: section.RootCause.isEditing() -->
            <div id="divEditRootCause">
              <textarea
                class="form-control"
                id="textareaFinalRootCause"
                data-bind="textInput: section.RootCause.determination"
              ></textarea>
              <br />
              <button
                type="button"
                id="buttonSaveFinalRootCause"
                class="btn btn-outline-secondary"
                data-bind="click: section.RootCause.save"
              >
                Save
              </button>
              <button
                type="button"
                id="buttonSaveProblemDescription"
                class="btn btn-outline-danger"
                data-bind="click: section.RootCause.cancel"
              >
                Cancel
              </button>
            </div>
            <!-- /ko -->
          </div>
        </div>
      </div>
      <br />
      <div class="card" id="cardSimilarNoncomformities">
        <div class="card-header"><h4>Similar Nonconformities</h4></div>
        <div class="card-body">
          <p>
            Could this nonconformance occur in another one of your office
            processes or in a corresponding office in another CGFS location?
          </p>
          <!-- ko if: section.SimilarNonconformity.isEditing()  -->
          <select
            id="selectSimilarBool"
            data-bind="value: section.SimilarNonconformity.otherOfficeBool"
          >
            <option value="No">No</option>
            <option value="Yes">Yes</option>
          </select>
          <!-- /ko -->
          <!-- ko ifnot: section.SimilarNonconformity.isEditing()  -->
          <p data-bind="text: selectedRecord.SimilarNoncomformityBool()"></p>
          <!-- /ko -->
          <div id="divSimilarNoncomformityArea">
            <b>Explanation:<span class="required">*</span></b>
            <br />
            <!-- ko ifnot: section.SimilarNonconformity.isEditing()  -->
            <div id="divDispSimilarNoncomformityDesc">
              <p
                id="spanSimilarNoncomformityDesc"
                data-bind="text: selectedRecord.SimilarNoncomformityDesc()"
              ></p>
              <button
                type="button"
                id="buttonEditSimilarNoncomformity"
                data-bind="visible: section.SimilarNonconformity.isEditable(),
                          click: section.SimilarNonconformity.edit"
                class="btn btn-outline-secondary"
              >
                Edit
              </button>
            </div>
            <!-- /ko -->
            <!-- ko if: section.SimilarNonconformity.isEditing()  -->
            <div id="divEditSimilarNoncomformityDesc">
              <textarea
                class="form-control"
                id="textareaEditSimilarNoncomformityDesc"
                data-bind="textInput: section.SimilarNonconformity.explanation"
              ></textarea>
              <br />
              <button
                type="button"
                id="buttonSaveSimilarNoncomformity"
                data-bind="click: section.SimilarNonconformity.save"
                class="btn btn-outline-secondary"
              >
                Save
              </button>
              <button
                type="button"
                id="buttonSaveSimilarNoncomformity"
                data-bind="click: section.SimilarNonconformity.cancel"
                class="btn btn-outline-danger"
              >
                Cancel
              </button>
            </div>
            <!-- /ko -->
          </div>
        </div>
      </div>
      <!-- /ko -->
    </div>
    <!-- /ko -->
    <!-- ko if: controls.showSectionByStageNum(2) -->
    <br />
    <div class="card" id="cardSupportingDocuments">
      <div class="card-header"><h4>Supporting Documents</h4></div>
      <div class="card-body">
        <div class="alert alert-warning">
          <b>Notice:</b>
          <p>Please do not upload PII.</p>
        </div>
        <div>
          <!-- ko if: section.SupportDocs.allowUploadSupportDoc() -->
          <button
            type="button"
            id="buttonUploadRequestDoc"
            class="btn btn-outline-primary"
            data-bind="click: section.SupportDocs.new"
          >
            Upload
          </button>
          <!-- /ko -->
          <!--<a id="linkUploadRequestDoc" title="Upload Request Document" href="javascript:void(0)"><span class="ui-icon ui-icon-circle-arrow-n">Upload Request Document</span>Upload Supporting Doc</a>-->
        </div>
        <br />
        <div data-bind="visible: SupportDocuments().length > 0">
          <table class="table">
            <thead>
              <tr>
                <th>Title</th>
                <th>File Name</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody data-bind="foreach: SupportDocuments">
              <tr>
                <td class="align-middle" data-bind="text: Title"></td>
                <td>
                  <a
                    class="btn btn-link"
                    title="Click to download"
                    data-bind="attr: {href: $root.formatDocDownloadLink(FileRef)}, text: FileLeafRef"
                  ></a>
                </td>
                <td>
                  <button
                    type="button"
                    class="btn btn-link"
                    title="View Document"
                    data-bind="click: $root.section.SupportDocs.view.bind($data)"
                  >
                    <i class="fa-solid fa-magnifying-glass"></i>
                  </button>
                  <!-- ko if: $root.section.SupportDocs.allowUploadSupportDoc -->
                  <button
                    type="button"
                    class="btn btn-link"
                    title="Edit Document"
                    data-bind="click: $root.section.SupportDocs.edit.bind($data)"
                  >
                    <i class="fa-solid fa-pen-to-square"></i>
                  </button>
                  <!-- /ko -->
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
    <br />
    <div class="card" id="cardActionList">
      <div class="card-header"><h4>Actions List</h4></div>
      <div class="card-body">
        <div>
          <!-- ko if: section.Actions.allowSubmitNewAction() -->
          <button
            type="button"
            id="buttonSubmitNewAction"
            class="btn btn-outline-success"
            data-bind="click: section.Actions.new"
          >
            New Action
          </button>
          <!-- /ko -->
          <!--<a id="linkSubmitNewAction" href="javascript:void(0)"><span class='ui-icon ui-icon-plus'></span>Create a New Action</a>-->
        </div>
        <div
          class="empty-table"
          data-bind="visible: ActionListItems().length == 0"
        >
          <h2>
            This record currently has no associated actions. Create a new one.
          </h2>
        </div>
        <div data-bind="visible: ActionListItems().length > 0">
          <table class="table">
            <thead>
              <tr>
                <th>Mark Complete</th>
                <th>Action ID</th>
                <th>Action Description</th>
                <th>Responsible Person</th>
                <th>Target Date</th>
                <th>Completion Date</th>
                <th>Status</th>
                <th>Revisions</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody data-bind="foreach: ActionListItems">
              <tr>
                <td data-bind="">
                  <button
                    data-bind="enable: $root.section.Actions.completeEnable($data),
                                visible: !$root.section.Actions.requiresApproval($data),
                                css: $root.section.Actions.completeClass($data),
                                text: $root.section.Actions.completeText($data),
                                click: $root.section.Actions.completeClick.bind($data)"
                    type="button"
                    class="btn"
                  ></button>
                  <!-- ko if: $root.section.Actions.requiresApproval($data) -->
                  <button
                    data-bind="visible: $root.section.Actions.requiresApproval($data),
                                      click: $root.section.Actions.approvalApproveClick.bind($data)"
                    type="button"
                    class="btn btn-success"
                  >
                    Approve
                  </button>
                  <button
                    data-bind="visible: $root.section.Actions.requiresApproval($data),
                                      click: $root.section.Actions.approvalRejectClick.bind($data)"
                    type="button"
                    class="btn btn-danger"
                  >
                    Reject
                  </button>
                  <button
                    type="button"
                    data-bind="click: $root.section.Actions.changesClick.bind($data)"
                    class="btn btn-outline-info"
                  >
                    Changes
                  </button>
                  <!-- /ko  -->
                </td>
                <td data-bind="text: ActionID"></td>
                <td data-bind="html: ActionDescription"></td>
                <td
                  data-bind="text: ActionResponsiblePerson.get_lookupValue()"
                ></td>
                <td
                  data-bind="text: TargetDate ? new Date(TargetDate).format('yyyy-MM-dd') : ''"
                ></td>
                <td
                  data-bind="text: ImplementationDate ? new Date(ImplementationDate).format('yyyy-MM-dd') : ''"
                ></td>
                <td data-bind="text: ImplementationStatus"></td>
                <td data-bind="text: RevisionCount"></td>
                <td data-bind="">
                  <button
                    type="button"
                    data-bind="enable: $root.section.Actions.isEditable($data),
                                click: $root.section.Actions.editClick.bind($data)"
                    class="btn btn-outline-secondary"
                  >
                    Edit
                  </button>
                  <button
                    type="button"
                    data-bind="click: $root.section.Actions.historyClick.bind($data)"
                    class="btn btn-outline-info"
                  >
                    History
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <br /><br />
        <div>
          <button
            type="button"
            id=""
            class="mt-auto btn btn-outline-primary buttonSubmitInitial"
            data-bind="enable: controls.stage2.enableSubmitActionPlan(), 
                    visible: controls.stage2.showSubmitActionPlan(),
                    click: controls.stage2.submitActionPlan"
          >
            Submit
          </button>
        </div>
      </div>
    </div>
    <br />
    <!-- /ko -->
    <div
      class="card"
      id="cardEffectivenessDocuments"
      data-bind="visible: section.EffectivenessDocs.ShowEffectivenessDocs()"
    >
      <!-- ko with: section.EffectivenessDocs -->
      <div class="card-header"><h4>Effectiveness Documents</h4></div>
      <div class="card-body">
        <div class="card">
          <div class="card-body">
            <h3>1. Office Risk Impact<span class="required">*</span></h3>
            <h4>
              Does this CAR/CAP impact your Office Risks, Mitigations, or
              Internal Controls?
            </h4>
            <!-- ko if: officeRisk.isEditing -->
            <select
              id="selectOfficeImpactBool"
              name="OfficeImpactBool"
              data-bind="value: officeRisk.bool"
            >
              <option value="false">No</option>
              <option value="true">Yes</option>
            </select>
            <!-- /ko -->
            <!-- ko ifnot: officeRisk.isEditing() -->
            <b
              data-bind="text: $root.selectedRecord.OfficeImpactBool() ? 'True' : 'False'"
            ></b>
            <!-- /ko -->
            <div>
              <div id="divEditOfficeImpactDesc">
                <h4>
                  Please give a brief explanation:<span class="required"
                    >*</span
                  >
                </h4>
                <div class="alert alert-info">
                  <b>Notice:</b>
                  <p>
                    It is the responsibility of the QSO to ensure the Office
                    Risks, Mitigations, and Internal Control document is updated
                    as needed.
                  </p>
                </div>
                <!-- ko if: officeRisk.isEditing -->
                <textarea
                  class="form-control"
                  id="textareaOfficeImpactDesc"
                  data-bind="textInput: officeRisk.description"
                ></textarea>
                <br />
                <button
                  type="button"
                  id="buttonSaveOfficeImpactDesc"
                  class="btn btn-outline-primary"
                  data-bind="click: officeRisk.saveClick"
                >
                  Save
                </button>
                <button
                  type="button"
                  id=""
                  class="btn btn-outline-danger"
                  data-bind="click: officeRisk.cancelClick"
                >
                  Cancel
                </button>
                <!-- /ko -->
                <!-- ko ifnot: officeRisk.isEditing() -->
                <div
                  class="rich-text"
                  data-bind="text: $root.selectedRecord.OfficeImpactDesc"
                ></div>
                <button
                  type="button"
                  id=""
                  class="btn btn-outline-secondary"
                  data-bind="visible: $root.section.EffectivenessDocs.isEditable(), 
                          click: officeRisk.editClick"
                >
                  Edit
                </button>
                <!-- /ko -->
              </div>
            </div>
          </div>
        </div>
        <br /><br />
        <div class="card">
          <div class="card-body">
            <h3>2. Proof of Effectiveness<span class="required">*</span></h3>
            <p>
              Provide a text description using the textarea below, or upload
              documents by selecting the upload button.
            </p>
            <h4>Text Description:</h4>
            <!-- ko ifnot: proof.isEditing() -->
            <div id="divDispEffectivenessDesc">
              <div
                class="rich-text"
                id="pEffectivenessDesc"
                data-bind="text: $root.selectedRecord.EffectivenessDescription()"
              ></div>
              <button
                type="button"
                id=""
                class="btn btn-outline-secondary"
                data-bind="visible: $root.section.EffectivenessDocs.isEditable(),
                        click: proof.editClick"
              >
                Edit
              </button>
            </div>
            <!-- /ko -->
            <!-- ko if: proof.isEditing() -->
            <div id="">
              <textarea
                class="form-control"
                id=""
                data-bind="textInput: proof.description"
              ></textarea>
              <br />
              <button
                type="button"
                id=""
                class="btn btn-outline-primary"
                data-bind="click: proof.saveClick"
              >
                Save
              </button>
              <button
                type="button"
                id=""
                class="btn btn-outline-danger"
                data-bind="click: proof.cancelClick"
              >
                Cancel
              </button>
            </div>
            <!-- /ko -->
            <p class="font-weight-bold">and/or</p>
            <h4>Upload Effectiveness Documents:</h4>
            <div class="alert alert-warning">
              <b>Notice:</b>
              <p>Please do not upload PII.</p>
            </div>
            <div>
              <button
                type="button"
                id=""
                class="btn btn-outline-primary"
                data-bind="visible: $root.section.EffectivenessDocs.isEditable(),
                          click: proof.documents.new"
              >
                Upload
              </button>
              <!--<a title='Upload Effectiveness Document' id="linkUploadEffectivenessDoc" href='javascript:void(0)'><span class='ui-icon ui-icon-circle-arrow-n'></span>Upload Effectiveness Doc</a>-->
            </div>
            <br />
            <div data-bind="visible: $root.EffectivenessDocuments().length > 0">
              <table class="table">
                <thead>
                  <tr>
                    <th>Title</th>
                    <th>File Name</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody data-bind="foreach: $root.EffectivenessDocuments">
                  <tr>
                    <td class="align-middle" data-bind="text: Title"></td>
                    <td>
                      <a
                        class="btn btn-link"
                        title="Click to download"
                        data-bind="attr: {href: $root.formatDocDownloadLink(FileRef)}, text: FileLeafRef"
                      ></a>
                    </td>
                    <td>
                      <button
                        type="button"
                        class="btn btn-link"
                        title="View Document"
                        data-bind="click: $parent.proof.documents.view.bind($data)"
                      >
                        <i class="fa-solid fa-magnifying-glass"></i>
                      </button>
                      <!-- ko if: $root.section.EffectivenessDocs.isEditable() -->
                      <button
                        type="button"
                        class="btn btn-link"
                        title="Edit Document"
                        data-bind="click: $parent.proof.documents.edit"
                      >
                        <i class="fa-solid fa-pen-to-square"></i>
                      </button>
                      <!-- /ko -->
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
        <button
          type="button"
          class="btn btn-outline-primary"
          data-bind="enable: $root.controls.stage4.enableEffectivenessSubmit(),
                    visible: $root.controls.stage4.showEffectivenessSubmit(),
                    click: $root.controls.stage4.submitEffectiveness"
        >
          Submit Effectiveness
        </button>
      </div>
      <!-- /ko -->
    </div>
  </div>
  <!-- /ko -->
</script>

<!-- Awaiting Action  -->
<script type="text/html" id="tabs-awaiting">
  <div>
    <div class="card">
      <div class="card-header"><h4>CAP/CARs Requiring Action</h4></div>
      <div class="card-body">
        <div
          class="container empty-table"
          data-bind="visible: myAwaitingActionRecords().length == 0"
        >
          <h2>You currently have no CARs/CAPs awaiting action.</h2>
        </div>
        <div
          data-bind="visible: myAwaitingActionRecords().length > 0,
          with: myAwaitingActionRecords, as: 'myAwaitingActionRecords'"
        >
          <table
            id="tblMyAwaitingActionRecords"
            class="display"
            data-bind="descendantsComplete: $root.bindingCompleteHandlers.tableBound"
          >
            <thead>
              <tr>
                <th>Item #</th>
                <th>Subject</th>
                <th data-bind="visible: $root.AdminType">Business Office</th>
                <th>CGFS Location</th>
                <th>Next Target Date</th>
                <th>Coordinator</th>
                <th>Status</th>
                <th>Type</th>
              </tr>
            </thead>
            <tbody data-bind="foreach: myAwaitingActionRecords">
              <tr>
                <td>
                  <a
                    href="#"
                    data-bind="click: $root.navigateToRecord.bind($data), text: Title"
                  ></a>
                </td>
                <td
                  data-bind="text: Common.Utilities.truncateText(Subject, 60), attr: { title: Subject}"
                ></td>
                <td
                  data-bind="visible: $root.AdminType(), text: BusinessOffice.get_lookupValue()"
                ></td>
                <td data-bind="text: CGFSLocation"></td>
                <td
                  data-bind="text: $root.formatNextTargetDate($data),
                            style: {'background-color' : $root.highlightOverdue($data)}"
                ></td>
                <td data-bind="text: CoordinatorName"></td>
                <td data-bind="text: ProcessStage"></td>
                <td data-bind="text: RecordType"></td>
              </tr>
            </tbody>
            <tfoot>
              <tr>
                <th>Item #</th>
                <th>Subject</th>
                <th data-bind="visible: $root.AdminType">Business Office</th>
                <th>CGFS Location</th>
                <th>Next Target Date</th>
                <th>Coordinator</th>
                <th>Status</th>
                <th>Type</th>
              </tr>
            </tfoot>
          </table>
        </div>
      </div>
    </div>
    <br />
    <div class="card" id="cardAwaitingActionList">
      <div class="card-header">
        <h4>Action Items Requiring Action</h4>
      </div>
      <div class="card-body">
        <div
          class="container empty-table"
          data-bind="visible: myAwaitingActionActions().length == 0"
        >
          <h2>You currently have no actions awaiting action.</h2>
        </div>
        <!--<table id="tblAwaitingActions" class="display" style="width:100%">
                      <thead>
                          <tr>
                              <th>Mark Complete</th>
                              <th>Action ID</th>
                              <th>Action Description</th>
                              <th>Previous Target Date</th>
                              <th>Current Target Date</th>
                              <th>Completion Date</th>
                              <th>Implementation Status</th>
                              <th style="display: none">Action</th>
                          </tr>
                      </thead>
                  </table>-->
        <div
          data-bind="visible: myAwaitingActionActions().length > 0,
          with: myAwaitingActionActions, as: 'myAwaitingActionActions'"
        >
          <table
            id="tblAwaitingAction"
            class="table"
            data-bind="descendantsComplete: $root.bindingCompleteHandlers.tableBound"
          >
            <thead>
              <tr>
                <th>Mark Complete</th>
                <th>Action ID</th>
                <th>Action Description</th>
                <th>Responsible Person</th>
                <th>Target Date</th>
                <th>Completion Date</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody data-bind="foreach: myAwaitingActionActions">
              <tr>
                <td data-bind="">
                  <button
                    data-bind="click: $root.navigateToRecord.bind($data)"
                    type="button"
                    class="btn btn-outline-secondary"
                  >
                    View
                  </button>
                </td>
                <td data-bind="text: ActionID"></td>
                <td data-bind="text: ActionDescription"></td>
                <td data-bind="text: ActionResponsiblePerson.userName"></td>
                <td
                  data-bind="text: TargetDate ?
                   new Date(TargetDate).format('yyyy-MM-dd') : ''"
                ></td>
                <td
                  data-bind="text: ImplementationDate ?
                   new Date(ImplementationDate).format('yyyy-MM-dd') : ''"
                ></td>
                <td data-bind="text: ImplementationStatus"></td>
                <td data-bind="">
                  <button
                    type="button"
                    data-bind="click:  $root.section.Actions.historyClick.bind($data)"
                    class="btn btn-outline-info"
                  >
                    History
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</script>
<!-- Lookup -->
<script type="text/html" id="tabs-lookup">
  <div class="card">
    <div class="card-header">
      <h3>View All CARs and CAPs</h3>
    </div>

    <div class="card-body">
      <div class="alert alert-info">
        <p>
          Select "Update List" below to refresh the latest information about all
          CARs and CAPs in the system.
        </p>
      </div>
      <!--<label for="selectOffice">Please select an office:</label>
                <select id="selectOffice" />-->
      <button type="button" id="btnRequestAllRecords" class="btn btn-primary">
        Update List
      </button>
      <div
        data-bind="visible: allRecordsArray().length > 0,
        with: allRecordsArray, as: 'allRecordsArray'"
      >
        <table
          id="tblLookupRecords"
          class="table table-striped table-hover w-100"
          data-bind="descendantsComplete: $root.bindingCompleteHandlers.tableBound"
        >
          <thead>
            <tr>
              <th>Item #</th>
              <th>Subject</th>
              <th>Business Office</th>
              <th>CGFS Location</th>
              <th>Next Target Date</th>
              <th>Coordinator</th>
              <th>Status</th>
              <th>Type</th>
            </tr>
            <tr>
              <th data-filter="select-filter"></th>
              <th data-filter="search-filter" column-width="max"></th>
              <th data-filter="select-filter" column-width="max"></th>
              <th data-filter="select-filter"></th>
              <th data-filter="select-filter"></th>
              <th data-filter="select-filter"></th>
              <th data-filter="select-filter"></th>
              <th data-filter="select-filter"></th>
            </tr>
          </thead>
          <tbody data-bind="foreach: allRecordsArray">
            <tr>
              <td
                class="plan-id"
                data-bind="click: $root.navigateToRecord.bind($data), text: Title"
              ></td>
              <td
                data-bind="text: Common.Utilities.truncateText(Subject, 60), attr: { title: Subject}"
              ></td>
              <td data-bind="text: BusinessOffice.get_lookupValue()"></td>
              <td data-bind="text: CGFSLocation"></td>
              <td
                data-bind="text: $root.formatNextTargetDate($data),
                                                style: {'background-color' : $root.highlightOverdue($data)}"
              ></td>
              <td data-bind="text: CoordinatorName"></td>
              <td data-bind="text: ProcessStage"></td>
              <td data-bind="text: RecordType"></td>
            </tr>
          </tbody>
          <tfoot></tfoot>
        </table>
      </div>
    </div>
  </div>
</script>

<!-- <link
  rel="stylesheet"
  type="text/css"
  href="https://cdn.jsdelivr.net/npm/fomantic-ui@2.8.7/dist/semantic.min.css"
/>
<script src="https://cdn.jsdelivr.net/npm/fomantic-ui@2.8.7/dist/semantic.min.js"></script> -->

<script
  type="module"
  src="/sites/CGFS-QMS/Style Library/apps/qms-ci/dist/pages/app/app.js"
></script>
